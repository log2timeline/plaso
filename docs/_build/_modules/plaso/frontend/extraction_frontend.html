<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>plaso.frontend.extraction_frontend &mdash; Plaso 1.4.1_20160603 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.4.1_20160603',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Plaso 1.4.1_20160603 documentation" href="../../../index.html" />
    <link rel="up" title="plaso" href="../../plaso.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Plaso 1.4.1_20160603 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../plaso.html" accesskey="U">plaso</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for plaso.frontend.extraction_frontend</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;The extraction front-end.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="kn">from</span> <span class="nn">dfvfs.lib</span> <span class="kn">import</span> <span class="n">definitions</span> <span class="k">as</span> <span class="n">dfvfs_definitions</span>
<span class="kn">from</span> <span class="nn">dfvfs.resolver</span> <span class="kn">import</span> <span class="n">context</span>

<span class="kn">from</span> <span class="nn">plaso</span> <span class="kn">import</span> <span class="n">parsers</span>   <span class="c1"># pylint: disable=unused-import</span>
<span class="kn">from</span> <span class="nn">plaso</span> <span class="kn">import</span> <span class="n">hashers</span>   <span class="c1"># pylint: disable=unused-import</span>
<span class="kn">from</span> <span class="nn">plaso.containers</span> <span class="kn">import</span> <span class="n">sessions</span>
<span class="kn">from</span> <span class="nn">plaso.engine</span> <span class="kn">import</span> <span class="n">single_process</span>
<span class="kn">from</span> <span class="nn">plaso.engine</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">engine_utils</span>
<span class="kn">from</span> <span class="nn">plaso.frontend</span> <span class="kn">import</span> <span class="n">frontend</span>
<span class="kn">from</span> <span class="nn">plaso.frontend</span> <span class="kn">import</span> <span class="n">presets</span>
<span class="kn">from</span> <span class="nn">plaso.lib</span> <span class="kn">import</span> <span class="n">definitions</span>
<span class="kn">from</span> <span class="nn">plaso.lib</span> <span class="kn">import</span> <span class="n">errors</span>
<span class="kn">from</span> <span class="nn">plaso.lib</span> <span class="kn">import</span> <span class="n">event</span>
<span class="kn">from</span> <span class="nn">plaso.multi_processing</span> <span class="kn">import</span> <span class="n">multi_process</span>
<span class="kn">from</span> <span class="nn">plaso.hashers</span> <span class="kn">import</span> <span class="n">manager</span> <span class="k">as</span> <span class="n">hashers_manager</span>
<span class="kn">from</span> <span class="nn">plaso.parsers</span> <span class="kn">import</span> <span class="n">manager</span> <span class="k">as</span> <span class="n">parsers_manager</span>
<span class="kn">from</span> <span class="nn">plaso.storage</span> <span class="kn">import</span> <span class="n">zip_file</span> <span class="k">as</span> <span class="n">storage_zip_file</span>

<span class="kn">import</span> <span class="nn">pytz</span>  <span class="c1"># pylint: disable=wrong-import-order</span>


<div class="viewcode-block" id="ExtractionFrontend"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend">[docs]</a><span class="k">class</span> <span class="nc">ExtractionFrontend</span><span class="p">(</span><span class="n">frontend</span><span class="o">.</span><span class="n">Frontend</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Class that implements an extraction front-end.&quot;&quot;&quot;</span>

  <span class="n">_DEFAULT_PROFILING_SAMPLE_RATE</span> <span class="o">=</span> <span class="mi">1000</span>

  <span class="c1"># Approximately 250 MB of queued items per worker.</span>
  <span class="n">_DEFAULT_QUEUE_SIZE</span> <span class="o">=</span> <span class="mi">125000</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes the front-end object.&quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ExtractionFrontend</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_collection_process</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_debug_mode</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_enable_preprocessing</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_enable_profiling</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_filter_expression</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_filter_object</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hasher_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mount_path</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_operating_system</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parser_names</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_process_archive_files</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_profiling_sample_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_PROFILING_SAMPLE_RATE</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_profiling_type</span> <span class="o">=</span> <span class="s1">u&#39;all&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_use_old_preprocess</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_use_zeromq</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_queue_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_QUEUE_SIZE</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_resolver_context</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_single_process_mode</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_show_worker_memory_information</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_storage_file_path</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_text_prepend</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">_CheckStorageFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks if the storage file path is valid.</span>

<span class="sd">    Args:</span>
<span class="sd">      storage_file_path: The path of the storage file.</span>

<span class="sd">    Raises:</span>
<span class="sd">      BadConfigOption: if the storage file path is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">storage_file_path</span><span class="p">):</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">storage_file_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">BadConfigOption</span><span class="p">(</span>
            <span class="s1">u&#39;Storage file: {0:s} already exists and is not a file.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">storage_file_path</span><span class="p">))</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">u&#39;Appending to an already existing storage file.&#39;</span><span class="p">)</span>

    <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">storage_file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dirname</span><span class="p">:</span>
      <span class="n">dirname</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>

    <span class="c1"># TODO: add a more thorough check to see if the storage file really is</span>
    <span class="c1"># a plaso storage file.</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">BadConfigOption</span><span class="p">(</span>
          <span class="s1">u&#39;Unable to write to storage file: {0:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">storage_file_path</span><span class="p">))</span>

  <span class="c1"># Note that this function is not called by the normal termination.</span>
  <span class="k">def</span> <span class="nf">_CleanUpAfterAbort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Signals the tool to stop running nicely after an abort.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_process_mode</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug_mode</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">u&#39;Running in debug mode, set up debugger.&#39;</span><span class="p">)</span>
      <span class="n">pdb</span><span class="o">.</span><span class="n">post_mortem</span><span class="p">()</span>
      <span class="k">return</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">SignalAbort</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_GetParserFilterPreset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">os_guess</span><span class="o">=</span><span class="s1">u&#39;&#39;</span><span class="p">,</span> <span class="n">os_version</span><span class="o">=</span><span class="s1">u&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determines the parser filter preset.</span>

<span class="sd">    Args:</span>
<span class="sd">      os_guess: optional string containing the operating system guessed by</span>
<span class="sd">                the preprocessing.</span>
<span class="sd">      os_version: optional string containing the operating system version</span>
<span class="sd">                  determined by the preprocessing.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A string containing the parser filter preset, where None represents</span>
<span class="sd">      all parsers and plugins.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: Make this more sane. Currently we are only checking against</span>
    <span class="c1"># one possible version of Windows, and then making the assumption if</span>
    <span class="c1"># that is not correct we default to Windows 7. Same thing with other</span>
    <span class="c1"># OS&#39;s, no assumption or checks are really made there.</span>
    <span class="c1"># Also this is done by default, and no way for the user to turn off</span>
    <span class="c1"># this behavior, need to add a parameter to the frontend that takes</span>
    <span class="c1"># care of overwriting this behavior.</span>

    <span class="n">parser_filter_preset</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">parser_filter_preset</span> <span class="ow">and</span> <span class="n">os_version</span><span class="p">:</span>
      <span class="n">os_version</span> <span class="o">=</span> <span class="n">os_version</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

      <span class="c1"># TODO: Improve this detection, this should be more &#39;intelligent&#39;, since</span>
      <span class="c1"># there are quite a lot of versions out there that would benefit from</span>
      <span class="c1"># loading up the set of &#39;winxp&#39; parsers.</span>
      <span class="k">if</span> <span class="s1">u&#39;windows xp&#39;</span> <span class="ow">in</span> <span class="n">os_version</span><span class="p">:</span>
        <span class="n">parser_filter_preset</span> <span class="o">=</span> <span class="s1">u&#39;winxp&#39;</span>
      <span class="k">elif</span> <span class="s1">u&#39;windows server 2000&#39;</span> <span class="ow">in</span> <span class="n">os_version</span><span class="p">:</span>
        <span class="n">parser_filter_preset</span> <span class="o">=</span> <span class="s1">u&#39;winxp&#39;</span>
      <span class="k">elif</span> <span class="s1">u&#39;windows server 2003&#39;</span> <span class="ow">in</span> <span class="n">os_version</span><span class="p">:</span>
        <span class="n">parser_filter_preset</span> <span class="o">=</span> <span class="s1">u&#39;winxp&#39;</span>
      <span class="k">elif</span> <span class="s1">u&#39;windows&#39;</span> <span class="ow">in</span> <span class="n">os_version</span><span class="p">:</span>
        <span class="c1"># Fallback for other Windows versions.</span>
        <span class="n">parser_filter_preset</span> <span class="o">=</span> <span class="s1">u&#39;win7&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">parser_filter_preset</span> <span class="ow">and</span> <span class="n">os_guess</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">os_guess</span> <span class="o">==</span> <span class="n">definitions</span><span class="o">.</span><span class="n">OS_LINUX</span><span class="p">:</span>
        <span class="n">parser_filter_preset</span> <span class="o">=</span> <span class="s1">u&#39;linux&#39;</span>
      <span class="k">elif</span> <span class="n">os_guess</span> <span class="o">==</span> <span class="n">definitions</span><span class="o">.</span><span class="n">OS_MACOSX</span><span class="p">:</span>
        <span class="n">parser_filter_preset</span> <span class="o">=</span> <span class="s1">u&#39;macosx&#39;</span>
      <span class="k">elif</span> <span class="n">os_guess</span> <span class="o">==</span> <span class="n">definitions</span><span class="o">.</span><span class="n">OS_WINDOWS</span><span class="p">:</span>
        <span class="n">parser_filter_preset</span> <span class="o">=</span> <span class="s1">u&#39;win7&#39;</span>

    <span class="k">return</span> <span class="n">parser_filter_preset</span>

  <span class="k">def</span> <span class="nf">_PreprocessSources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path_specs</span><span class="p">,</span> <span class="n">source_type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Preprocesses the sources.</span>

<span class="sd">    Args:</span>
<span class="sd">      source_path_specs: list of path specifications (instances of</span>
<span class="sd">                         dfvfs.PathSpec) to process.</span>
<span class="sd">      source_type: the dfVFS source type definition.</span>

<span class="sd">    Returns:</span>
<span class="sd">      The preprocessing object (instance of PreprocessObject).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">preprocess_object</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_old_preprocess</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_storage_file_path</span><span class="p">):</span>
      <span class="c1"># Check if the storage file contains a preprocessing object.</span>
      <span class="n">storage_file</span> <span class="o">=</span> <span class="bp">None</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="c1"># TODO: refactor to use storage reader interface.</span>
        <span class="n">storage_file</span> <span class="o">=</span> <span class="n">storage_zip_file</span><span class="o">.</span><span class="n">StorageFile</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_storage_file_path</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">storage_information</span> <span class="o">=</span> <span class="n">storage_file</span><span class="o">.</span><span class="n">GetStorageInformation</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">storage_information</span><span class="p">:</span>
          <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">u&#39;Using preprocessing information from a prior run.&#39;</span><span class="p">)</span>
          <span class="n">preprocess_object</span> <span class="o">=</span> <span class="n">storage_information</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">_enable_preprocessing</span> <span class="o">=</span> <span class="bp">False</span>

      <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s1">u&#39;Unable to retrieve preprocessing information from storage file.&#39;</span><span class="p">)</span>

      <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">storage_file</span><span class="p">:</span>
          <span class="n">storage_file</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">u&#39;Starting preprocessing.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_enable_preprocessing</span> <span class="ow">and</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">dfvfs_definitions</span><span class="o">.</span><span class="n">SOURCE_TYPE_DIRECTORY</span><span class="p">,</span>
        <span class="n">dfvfs_definitions</span><span class="o">.</span><span class="n">SOURCE_TYPE_STORAGE_MEDIA_DEVICE</span><span class="p">,</span>
        <span class="n">dfvfs_definitions</span><span class="o">.</span><span class="n">SOURCE_TYPE_STORAGE_MEDIA_IMAGE</span><span class="p">]):</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">PreprocessSources</span><span class="p">(</span>
            <span class="n">source_path_specs</span><span class="p">,</span> <span class="n">resolver_context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolver_context</span><span class="p">)</span>

      <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">u&#39;Unable to preprocess with error: {0:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">exception</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">PreprocessObject</span><span class="p">()</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">u&#39;Preprocessing done.&#39;</span><span class="p">)</span>

    <span class="c1"># TODO: Remove the need for direct access to the preprocess_object in favor</span>
    <span class="c1"># of the knowledge base.</span>
    <span class="n">preprocess_object</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">knowledge_base</span><span class="p">,</span> <span class="s1">u&#39;_pre_obj&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">preprocess_object</span><span class="p">:</span>
      <span class="n">preprocess_object</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">PreprocessObject</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">preprocess_object</span>

  <span class="c1"># TODO: have the frontend fill collection information gradually</span>
  <span class="c1"># and set it as the last step of preprocessing?</span>
  <span class="c1"># Split in:</span>
  <span class="c1"># * extraction preferences (user preferences)</span>
  <span class="c1"># * extraction settings (actual settings used)</span>
  <span class="c1"># * output/storage settings</span>
  <span class="c1"># * processing settings</span>
  <span class="c1"># * source settings (support more than one source)</span>
  <span class="c1">#   * credentials (encryption)</span>
  <span class="c1">#   * mount point</span>

  <span class="k">def</span> <span class="nf">_CreateSessionStart</span><span class="p">(</span>
      <span class="bp">self</span><span class="p">,</span> <span class="n">command_line_arguments</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filter_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">parser_filter_expression</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">preferred_encoding</span><span class="o">=</span><span class="s1">u&#39;utf-8&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates the session start information.</span>

<span class="sd">    Args:</span>
<span class="sd">      command_line_arguments: optional string containing the command line</span>
<span class="sd">                              arguments.</span>
<span class="sd">      filter_file: optional string containing the path to a file with find</span>
<span class="sd">                   specifications.</span>
<span class="sd">      parser_filter_expression: optional string containining the parser filter</span>
<span class="sd">                                expression.</span>
<span class="sd">      preferred_encoding: optional string containing the preferred encoding.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A session start attribute container (instance of SessionStart).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">session_start</span> <span class="o">=</span> <span class="n">sessions</span><span class="o">.</span><span class="n">SessionStart</span><span class="p">()</span>

    <span class="n">session_start</span><span class="o">.</span><span class="n">command_line_arguments</span> <span class="o">=</span> <span class="n">command_line_arguments</span>
    <span class="n">session_start</span><span class="o">.</span><span class="n">filter_expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_expression</span>
    <span class="n">session_start</span><span class="o">.</span><span class="n">filter_file</span> <span class="o">=</span> <span class="n">filter_file</span>
    <span class="n">session_start</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug_mode</span>
    <span class="n">session_start</span><span class="o">.</span><span class="n">parser_filter_expression</span> <span class="o">=</span> <span class="n">parser_filter_expression</span>
    <span class="n">session_start</span><span class="o">.</span><span class="n">preferred_encoding</span> <span class="o">=</span> <span class="n">preferred_encoding</span>

    <span class="k">return</span> <span class="n">session_start</span>

  <span class="k">def</span> <span class="nf">_PreprocessSetCollectionInformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preprocess_object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the collection information as part of the preprocessing.</span>

<span class="sd">    Args:</span>
<span class="sd">      preprocess_object: a preprocess object (instance of PreprocessObject).</span>
<span class="sd">      engine: the engine object (instance of BaseEngine).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">collection_information</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># TODO: extraction info:</span>
    <span class="n">collection_information</span><span class="p">[</span><span class="s1">u&#39;configured_zone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preprocess_object</span><span class="o">.</span><span class="n">zone</span>
    <span class="n">collection_information</span><span class="p">[</span><span class="s1">u&#39;parsers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser_names</span>
    <span class="n">collection_information</span><span class="p">[</span><span class="s1">u&#39;preprocess&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enable_preprocessing</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operating_system</span><span class="p">:</span>
      <span class="n">collection_information</span><span class="p">[</span><span class="s1">u&#39;os_detected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operating_system</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">collection_information</span><span class="p">[</span><span class="s1">u&#39;os_detected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">u&#39;N/A&#39;</span>

    <span class="n">preprocess_object</span><span class="o">.</span><span class="n">collection_information</span> <span class="o">=</span> <span class="n">collection_information</span>

  <span class="k">def</span> <span class="nf">_PreprocessSetTimezone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preprocess_object</span><span class="p">,</span> <span class="n">timezone</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">UTC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the timezone as part of the preprocessing.</span>

<span class="sd">    Args:</span>
<span class="sd">      preprocess_object: a preprocess object (instance of PreprocessObject).</span>
<span class="sd">      timezone: optional preferred timezone.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">timezone</span><span class="p">:</span>
      <span class="n">timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">UTC</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">preprocess_object</span><span class="p">,</span> <span class="s1">u&#39;time_zone_str&#39;</span><span class="p">):</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">u&#39;Setting timezone to: {0:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">preprocess_object</span><span class="o">.</span><span class="n">time_zone_str</span><span class="p">))</span>

      <span class="k">try</span><span class="p">:</span>
        <span class="n">preprocess_object</span><span class="o">.</span><span class="n">zone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">preprocess_object</span><span class="o">.</span><span class="n">time_zone_str</span><span class="p">)</span>

      <span class="k">except</span> <span class="n">pytz</span><span class="o">.</span><span class="n">UnknownTimeZoneError</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">timezone</span><span class="p">:</span>
          <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">u&#39;timezone was not properly set, defaulting to UTC&#39;</span><span class="p">)</span>
          <span class="n">timezone</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">UTC</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">((</span>
              <span class="s1">u&#39;Unable to automatically configure timezone falling back &#39;</span>
              <span class="s1">u&#39;to preferred timezone value: {0:s}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timezone</span><span class="p">))</span>
        <span class="n">preprocess_object</span><span class="o">.</span><span class="n">zone</span> <span class="o">=</span> <span class="n">timezone</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># TODO: shouldn&#39;t the user to be able to always override the timezone</span>
      <span class="c1"># detection? Or do we need an input sanitization function.</span>
      <span class="n">preprocess_object</span><span class="o">.</span><span class="n">zone</span> <span class="o">=</span> <span class="n">timezone</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">preprocess_object</span><span class="p">,</span> <span class="s1">u&#39;zone&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
      <span class="n">preprocess_object</span><span class="o">.</span><span class="n">zone</span> <span class="o">=</span> <span class="n">timezone</span>

<div class="viewcode-block" id="ExtractionFrontend.GetHashersInformation"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.GetHashersInformation">[docs]</a>  <span class="k">def</span> <span class="nf">GetHashersInformation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the hashers information.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of tuples of hasher names and descriptions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">hashers_manager</span><span class="o">.</span><span class="n">HashersManager</span><span class="o">.</span><span class="n">GetHashersInformation</span><span class="p">()</span></div>

<div class="viewcode-block" id="ExtractionFrontend.GetParserPluginsInformation"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.GetParserPluginsInformation">[docs]</a>  <span class="k">def</span> <span class="nf">GetParserPluginsInformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser_filter_expression</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the parser plugins information.</span>

<span class="sd">    Args:</span>
<span class="sd">      parser_filter_expression: optional string containing the parser filter</span>
<span class="sd">                                expression, where None represents all parsers</span>
<span class="sd">                                and plugins.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of tuples of parser plugin names and descriptions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">parsers_manager</span><span class="o">.</span><span class="n">ParsersManager</span><span class="o">.</span><span class="n">GetParserPluginsInformation</span><span class="p">(</span>
        <span class="n">parser_filter_expression</span><span class="o">=</span><span class="n">parser_filter_expression</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExtractionFrontend.GetParserPresetsInformation"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.GetParserPresetsInformation">[docs]</a>  <span class="k">def</span> <span class="nf">GetParserPresetsInformation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the parser presets information.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of tuples of parser preset names and related parsers names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser_presets_information</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">preset_name</span><span class="p">,</span> <span class="n">parser_names</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">presets</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
      <span class="n">parser_presets_information</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">preset_name</span><span class="p">,</span> <span class="s1">u&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parser_names</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">parser_presets_information</span></div>

<div class="viewcode-block" id="ExtractionFrontend.GetParsersInformation"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.GetParsersInformation">[docs]</a>  <span class="k">def</span> <span class="nf">GetParsersInformation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the parsers information.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of tuples of parser names and descriptions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">parsers_manager</span><span class="o">.</span><span class="n">ParsersManager</span><span class="o">.</span><span class="n">GetParsersInformation</span><span class="p">()</span></div>

<div class="viewcode-block" id="ExtractionFrontend.GetNamesOfParsersWithPlugins"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.GetNamesOfParsersWithPlugins">[docs]</a>  <span class="k">def</span> <span class="nf">GetNamesOfParsersWithPlugins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Retrieves the names of parser with plugins.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of parser names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">parsers_manager</span><span class="o">.</span><span class="n">ParsersManager</span><span class="o">.</span><span class="n">GetNamesOfParsersWithPlugins</span><span class="p">()</span></div>

<div class="viewcode-block" id="ExtractionFrontend.ProcessSources"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.ProcessSources">[docs]</a>  <span class="k">def</span> <span class="nf">ProcessSources</span><span class="p">(</span>
      <span class="bp">self</span><span class="p">,</span> <span class="n">source_path_specs</span><span class="p">,</span> <span class="n">source_type</span><span class="p">,</span> <span class="n">command_line_arguments</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">enable_sigsegv_handler</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filter_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hasher_names_string</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">number_of_extraction_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">preferred_encoding</span><span class="o">=</span><span class="s1">u&#39;utf-8&#39;</span><span class="p">,</span>
      <span class="n">parser_filter_expression</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">single_process_mode</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
      <span class="n">status_update_callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">timezone</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">UTC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Processes the sources.</span>

<span class="sd">    Args:</span>
<span class="sd">      source_path_specs: list of path specifications (instances of</span>
<span class="sd">                         dfvfs.PathSpec) to process.</span>
<span class="sd">      source_type: the dfVFS source type definition.</span>
<span class="sd">      command_line_arguments: optional string of the command line arguments or</span>
<span class="sd">                              None if not set.</span>
<span class="sd">      enable_sigsegv_handler: optional boolean value to indicate the SIGSEGV</span>
<span class="sd">                              handler should be enabled.</span>
<span class="sd">      filter_file: optional path to a file that contains find specifications.</span>
<span class="sd">      hasher_names_string: optional comma separated string of names of</span>
<span class="sd">                           hashers to enable.</span>
<span class="sd">      number_of_extraction_workers: the number of extraction workers to run. If</span>
<span class="sd">                                    0, the number will be selected</span>
<span class="sd">                                    automatically.</span>
<span class="sd">      preferred_encoding: optional preferred encoding.</span>
<span class="sd">      parser_filter_expression: optional string containing the parser filter</span>
<span class="sd">                                expression, where None represents all parsers</span>
<span class="sd">                                and plugins.</span>
<span class="sd">      single_process_mode: optional boolean value to indicate if the front-end</span>
<span class="sd">                           should run in single process mode.</span>
<span class="sd">      status_update_callback: optional callback function for status updates.</span>
<span class="sd">      timezone: optional preferred timezone.</span>

<span class="sd">    Returns:</span>
<span class="sd">      The processing status (instance of ProcessingStatus) or None.</span>

<span class="sd">    Raises:</span>
<span class="sd">      SourceScannerError: if the source scanner could not find a supported</span>
<span class="sd">                          file system.</span>
<span class="sd">      UserAbort: if the user initiated an abort.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If the source is a directory or a storage media image</span>
    <span class="c1"># run pre-processing.</span>
    <span class="k">if</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">dfvfs_definitions</span><span class="o">.</span><span class="n">SOURCE_TYPE_DIRECTORY</span><span class="p">,</span>
        <span class="n">dfvfs_definitions</span><span class="o">.</span><span class="n">SOURCE_TYPE_STORAGE_MEDIA_DEVICE</span><span class="p">,</span>
        <span class="n">dfvfs_definitions</span><span class="o">.</span><span class="n">SOURCE_TYPE_STORAGE_MEDIA_IMAGE</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">SetEnablePreprocessing</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">SetEnablePreprocessing</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_CheckStorageFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_storage_file_path</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_single_process_mode</span> <span class="o">=</span> <span class="n">single_process_mode</span>
    <span class="k">if</span> <span class="n">source_type</span> <span class="o">==</span> <span class="n">dfvfs_definitions</span><span class="o">.</span><span class="n">SOURCE_TYPE_FILE</span><span class="p">:</span>
      <span class="c1"># No need to multi process a single file source.</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_single_process_mode</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_process_mode</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="n">single_process</span><span class="o">.</span><span class="n">SingleProcessEngine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_queue_size</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="n">multi_process</span><span class="o">.</span><span class="n">MultiProcessEngine</span><span class="p">(</span>
          <span class="n">maximum_number_of_queued_items</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_queue_size</span><span class="p">,</span>
          <span class="n">use_zeromq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_use_zeromq</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">SetEnableDebugOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_debug_mode</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">SetEnableProfiling</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_profiling</span><span class="p">,</span>
        <span class="n">profiling_sample_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_profiling_sample_rate</span><span class="p">,</span>
        <span class="n">profiling_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_profiling_type</span><span class="p">)</span>

    <span class="n">preprocess_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreprocessSources</span><span class="p">(</span><span class="n">source_path_specs</span><span class="p">,</span> <span class="n">source_type</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_operating_system</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">preprocess_object</span><span class="p">,</span> <span class="s1">u&#39;guessed_os&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">parser_filter_expression</span><span class="p">:</span>
      <span class="n">guessed_os</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operating_system</span>
      <span class="n">os_version</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">preprocess_object</span><span class="p">,</span> <span class="s1">u&#39;osversion&#39;</span><span class="p">,</span> <span class="s1">u&#39;&#39;</span><span class="p">)</span>
      <span class="n">parser_filter_expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GetParserFilterPreset</span><span class="p">(</span>
          <span class="n">os_guess</span><span class="o">=</span><span class="n">guessed_os</span><span class="p">,</span> <span class="n">os_version</span><span class="o">=</span><span class="n">os_version</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">parser_filter_expression</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">u&#39;Parser filter expression changed to: {0:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">parser_filter_expression</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_parser_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">parser_class</span> <span class="ow">in</span> <span class="n">parsers_manager</span><span class="o">.</span><span class="n">ParsersManager</span><span class="o">.</span><span class="n">GetParsers</span><span class="p">(</span>
        <span class="n">parser_filter_expression</span><span class="o">=</span><span class="n">parser_filter_expression</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_parser_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parser_class</span><span class="o">.</span><span class="n">NAME</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_hasher_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hasher_manager</span> <span class="o">=</span> <span class="n">hashers_manager</span><span class="o">.</span><span class="n">HashersManager</span>
    <span class="k">for</span> <span class="n">hasher_name</span> <span class="ow">in</span> <span class="n">hasher_manager</span><span class="o">.</span><span class="n">GetHasherNamesFromString</span><span class="p">(</span>
        <span class="n">hasher_names_string</span><span class="o">=</span><span class="n">hasher_names_string</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_hasher_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hasher_name</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_PreprocessSetTimezone</span><span class="p">(</span><span class="n">preprocess_object</span><span class="p">,</span> <span class="n">timezone</span><span class="o">=</span><span class="n">timezone</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filter_file</span><span class="p">:</span>
      <span class="n">filter_find_specs</span> <span class="o">=</span> <span class="n">engine_utils</span><span class="o">.</span><span class="n">BuildFindSpecsFromFile</span><span class="p">(</span>
          <span class="n">filter_file</span><span class="p">,</span> <span class="n">pre_obj</span><span class="o">=</span><span class="n">preprocess_object</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">filter_find_specs</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># TODO: deprecate the need for this function.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_PreprocessSetCollectionInformation</span><span class="p">(</span><span class="n">preprocess_object</span><span class="p">)</span>

    <span class="n">session_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CreateSessionStart</span><span class="p">(</span>
        <span class="n">command_line_arguments</span><span class="o">=</span><span class="n">command_line_arguments</span><span class="p">,</span> <span class="n">filter_file</span><span class="o">=</span><span class="n">filter_file</span><span class="p">,</span>
        <span class="n">parser_filter_expression</span><span class="o">=</span><span class="n">parser_filter_expression</span><span class="p">,</span>
        <span class="n">preferred_encoding</span><span class="o">=</span><span class="n">preferred_encoding</span><span class="p">)</span>

    <span class="n">storage_writer</span> <span class="o">=</span> <span class="n">storage_zip_file</span><span class="o">.</span><span class="n">ZIPStorageFileWriter</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage_file_path</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enable_profiling</span><span class="p">:</span>
      <span class="n">storage_writer</span><span class="o">.</span><span class="n">EnableProfiling</span><span class="p">(</span><span class="n">profiling_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_profiling_type</span><span class="p">)</span>

    <span class="n">storage_writer</span><span class="o">.</span><span class="n">Open</span><span class="p">()</span>
    <span class="n">storage_writer</span><span class="o">.</span><span class="n">WriteSessionStart</span><span class="p">(</span><span class="n">session_start</span><span class="p">)</span>

    <span class="n">processing_status</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_process_mode</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">u&#39;Starting extraction in single process mode.&#39;</span><span class="p">)</span>

        <span class="n">processing_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">ProcessSources</span><span class="p">(</span>
            <span class="n">source_path_specs</span><span class="p">,</span> <span class="n">storage_writer</span><span class="p">,</span> <span class="n">preprocess_object</span><span class="p">,</span>
            <span class="n">filter_find_specs</span><span class="o">=</span><span class="n">filter_find_specs</span><span class="p">,</span>
            <span class="n">filter_object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filter_object</span><span class="p">,</span>
            <span class="n">hasher_names_string</span><span class="o">=</span><span class="n">hasher_names_string</span><span class="p">,</span>
            <span class="n">mount_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mount_path</span><span class="p">,</span>
            <span class="n">parser_filter_expression</span><span class="o">=</span><span class="n">parser_filter_expression</span><span class="p">,</span>
            <span class="n">process_archive_files</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_archive_files</span><span class="p">,</span>
            <span class="n">resolver_context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolver_context</span><span class="p">,</span>
            <span class="n">status_update_callback</span><span class="o">=</span><span class="n">status_update_callback</span><span class="p">,</span>
            <span class="n">text_prepend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_text_prepend</span><span class="p">)</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">u&#39;Starting extraction in multi process mode.&#39;</span><span class="p">)</span>

        <span class="c1"># TODO: pass number_of_extraction_workers.</span>
        <span class="n">processing_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">ProcessSources</span><span class="p">(</span>
            <span class="n">source_path_specs</span><span class="p">,</span> <span class="n">storage_writer</span><span class="p">,</span> <span class="n">preprocess_object</span><span class="p">,</span>
            <span class="n">enable_sigsegv_handler</span><span class="o">=</span><span class="n">enable_sigsegv_handler</span><span class="p">,</span>
            <span class="n">filter_find_specs</span><span class="o">=</span><span class="n">filter_find_specs</span><span class="p">,</span>
            <span class="n">filter_object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filter_object</span><span class="p">,</span>
            <span class="n">hasher_names_string</span><span class="o">=</span><span class="n">hasher_names_string</span><span class="p">,</span>
            <span class="n">mount_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mount_path</span><span class="p">,</span>
            <span class="n">number_of_extraction_workers</span><span class="o">=</span><span class="n">number_of_extraction_workers</span><span class="p">,</span>
            <span class="n">parser_filter_expression</span><span class="o">=</span><span class="n">parser_filter_expression</span><span class="p">,</span>
            <span class="n">process_archive_files</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_archive_files</span><span class="p">,</span>
            <span class="n">status_update_callback</span><span class="o">=</span><span class="n">status_update_callback</span><span class="p">,</span>
            <span class="n">show_memory_usage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_show_worker_memory_information</span><span class="p">,</span>
            <span class="n">text_prepend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_text_prepend</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_CleanUpAfterAbort</span><span class="p">()</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">UserAbort</span>

    <span class="c1"># TODO: check if this still works and if still needed.</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_process_mode</span><span class="p">:</span>
        <span class="k">raise</span>

      <span class="c1"># The tool should generally not be run in single process mode</span>
      <span class="c1"># for other reasons than to debug. Hence the general error</span>
      <span class="c1"># catching.</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">u&#39;An uncaught exception occurred: {0:s}.</span><span class="se">\n</span><span class="s1">{1:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">exception</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()))</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug_mode</span><span class="p">:</span>
        <span class="n">pdb</span><span class="o">.</span><span class="n">post_mortem</span><span class="p">()</span>

    <span class="k">finally</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enable_profiling</span><span class="p">:</span>
        <span class="n">storage_writer</span><span class="o">.</span><span class="n">DisableProfiling</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">processing_status</span></div>

<div class="viewcode-block" id="ExtractionFrontend.SetDebugMode"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.SetDebugMode">[docs]</a>  <span class="k">def</span> <span class="nf">SetDebugMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable_debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enables or disables debug mode.</span>

<span class="sd">    Args:</span>
<span class="sd">      enable_debug: optional boolean value to indicate whether</span>
<span class="sd">                    debugging mode should be enabled. The default</span>
<span class="sd">                    is False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_debug_mode</span> <span class="o">=</span> <span class="n">enable_debug</span></div>

<div class="viewcode-block" id="ExtractionFrontend.SetEnablePreprocessing"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.SetEnablePreprocessing">[docs]</a>  <span class="k">def</span> <span class="nf">SetEnablePreprocessing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable_preprocessing</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enables or disables preprocessing.</span>

<span class="sd">    Args:</span>
<span class="sd">      enable_preprocessing: boolean value to indicate if the preprocessing</span>
<span class="sd">                            should be performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_enable_preprocessing</span> <span class="o">=</span> <span class="n">enable_preprocessing</span></div>

<div class="viewcode-block" id="ExtractionFrontend.SetEnableProfiling"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.SetEnableProfiling">[docs]</a>  <span class="k">def</span> <span class="nf">SetEnableProfiling</span><span class="p">(</span>
      <span class="bp">self</span><span class="p">,</span> <span class="n">enable_profiling</span><span class="p">,</span> <span class="n">profiling_sample_rate</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
      <span class="n">profiling_type</span><span class="o">=</span><span class="s1">u&#39;all&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enables or disables profiling.</span>

<span class="sd">    Args:</span>
<span class="sd">      enable_profiling: boolean value to indicate if the profiling should</span>
<span class="sd">                        be enabled.</span>
<span class="sd">      profiling_sample_rate: optional integer indicating the profiling sample</span>
<span class="sd">                             rate. The value contains the number of files</span>
<span class="sd">                             processed. The default value is 1000.</span>
<span class="sd">      profiling_type: optional profiling type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_enable_profiling</span> <span class="o">=</span> <span class="n">enable_profiling</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_profiling_sample_rate</span> <span class="o">=</span> <span class="n">profiling_sample_rate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_profiling_type</span> <span class="o">=</span> <span class="n">profiling_type</span></div>

<div class="viewcode-block" id="ExtractionFrontend.SetShowMemoryInformation"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.SetShowMemoryInformation">[docs]</a>  <span class="k">def</span> <span class="nf">SetShowMemoryInformation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_memory</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets a flag telling the worker monitor to show memory information.</span>

<span class="sd">    Args:</span>
<span class="sd">      show_memory: a boolean (defaults to True) that indicates whether or not</span>
<span class="sd">                   the foreman should include memory information as part of</span>
<span class="sd">                   the worker monitoring.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_show_worker_memory_information</span> <span class="o">=</span> <span class="n">show_memory</span></div>

<div class="viewcode-block" id="ExtractionFrontend.SetStorageFile"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.SetStorageFile">[docs]</a>  <span class="k">def</span> <span class="nf">SetStorageFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the storage file path.</span>

<span class="sd">    Args:</span>
<span class="sd">      storage_file_path: The path of the storage file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_storage_file_path</span> <span class="o">=</span> <span class="n">storage_file_path</span></div>

<div class="viewcode-block" id="ExtractionFrontend.SetTextPrepend"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.SetTextPrepend">[docs]</a>  <span class="k">def</span> <span class="nf">SetTextPrepend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_prepend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets the text prepend.</span>

<span class="sd">    Args:</span>
<span class="sd">      text_prepend: free form text that is prepended to each path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_text_prepend</span> <span class="o">=</span> <span class="n">text_prepend</span></div>

<div class="viewcode-block" id="ExtractionFrontend.SetUseOldPreprocess"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.SetUseOldPreprocess">[docs]</a>  <span class="k">def</span> <span class="nf">SetUseOldPreprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_old_preprocess</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the use old preprocess flag.</span>

<span class="sd">    Args:</span>
<span class="sd">      use_old_preprocess: boolean value to indicate if the engine should</span>
<span class="sd">                          use the old preprocessing information or run</span>
<span class="sd">                          preprocessing again.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_use_old_preprocess</span> <span class="o">=</span> <span class="n">use_old_preprocess</span></div>

<div class="viewcode-block" id="ExtractionFrontend.SetUseZeroMQ"><a class="viewcode-back" href="../../../plaso.frontend.html#plaso.frontend.extraction_frontend.ExtractionFrontend.SetUseZeroMQ">[docs]</a>  <span class="k">def</span> <span class="nf">SetUseZeroMQ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_zeromq</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets whether the frontend is using ZeroMQ for queueing or not.</span>

<span class="sd">    Args:</span>
<span class="sd">      use_zeromq: optional boolean value to indicate if ZeroMQ should be used</span>
<span class="sd">                  for queuing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_use_zeromq</span> <span class="o">=</span> <span class="n">use_zeromq</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Plaso 1.4.1_20160603 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../plaso.html" >plaso</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright The Plaso Project Authors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.2.
    </div>
  </body>
</html>