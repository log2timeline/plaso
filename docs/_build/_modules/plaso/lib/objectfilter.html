<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>plaso.lib.objectfilter &mdash; Plaso 1.4.1_20160603 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.4.1_20160603',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Plaso 1.4.1_20160603 documentation" href="../../../index.html" />
    <link rel="up" title="plaso" href="../../plaso.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Plaso 1.4.1_20160603 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../plaso.html" accesskey="U">plaso</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for plaso.lib.objectfilter</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;Classes to perform filtering of objects based on their data members.</span>

<span class="sd">Given a list of objects and a textual filter expression, these classes allow</span>
<span class="sd">you to determine which objects match the filter. The system has two main</span>
<span class="sd">pieces: A parser for the supported grammar and a filter implementation.</span>

<span class="sd">Given any complying user-supplied grammar, it is parsed with a custom lexer</span>
<span class="sd">based on GRR&#39;s lexer and then compiled into an actual implementation by using</span>
<span class="sd">the filter implementation. A filter implementation simply provides actual</span>
<span class="sd">implementations for the primitives required to perform filtering. The compiled</span>
<span class="sd">result is always a class supporting the Filter interface.</span>

<span class="sd">If we define a class called Car such as:</span>


<span class="sd">class Car(object):</span>
<span class="sd">  def __init__(self, code, color=&quot;white&quot;, doors=3):</span>
<span class="sd">    self.code = code</span>
<span class="sd">    self.color = color</span>
<span class="sd">    self.doors = 3</span>

<span class="sd">And we have two instances:</span>

<span class="sd">  ford_ka = Car(&quot;FORDKA1&quot;, color=&quot;grey&quot;)</span>
<span class="sd">  toyota_corolla = Car(&quot;COROLLA1&quot;, color=&quot;white&quot;, doors=5)</span>
<span class="sd">  fleet = [ford_ka, toyota_corolla]</span>

<span class="sd">We want to find cars that are grey and have 3 or more doors. We could filter</span>
<span class="sd">our fleet like this:</span>

<span class="sd">  criteria = &quot;(color is grey) and (doors &gt;= 3)&quot;</span>
<span class="sd">  parser = ContextFilterParser(criteria).Parse()</span>
<span class="sd">  compiled_filter = parser.Compile(LowercaseAttributeFilterImp)</span>

<span class="sd">  for car in fleet:</span>
<span class="sd">    if compiled_filter.Matches(car):</span>
<span class="sd">      print(&quot;Car %s matches the supplied filter.&quot; % car.code)</span>

<span class="sd">The filter expression contains two subexpressions joined by an AND operator:</span>
<span class="sd">  &quot;color is grey&quot; and &quot;doors &gt;= 3&quot;</span>

<span class="sd">This means we want to search for objects matching these two subexpressions.</span>
<span class="sd">Let&#39;s analyze the first one in depth &quot;color is grey&quot;:</span>

<span class="sd">  &quot;color&quot;: the left operand specifies a search path to look for the data. This</span>
<span class="sd">  tells our filtering system to look for the color property on passed objects.</span>
<span class="sd">  &quot;is&quot;: the operator. Values retrieved for the &quot;color&quot; property will be checked</span>
<span class="sd">  against the right operand to see if they are equal.</span>
<span class="sd">  &quot;grey&quot;: the right operand. It specifies an explicit value to check for.</span>

<span class="sd">So each time an object is passed through the filter, it will expand the value</span>
<span class="sd">of the color data member, and compare its value against &quot;grey&quot;.</span>

<span class="sd">Because data members of objects are often not simple datatypes but other</span>
<span class="sd">objects, the system allows you to reference data members within other data</span>
<span class="sd">members by separating each by a dot. Let&#39;s see an example:</span>

<span class="sd">Let&#39;s add a more complex Car class with default tyre data:</span>


<span class="sd">class CarWithTyres(Car):</span>
<span class="sd">  def __init__(self, code, tyres=None, color=&quot;white&quot;, doors=3):</span>
<span class="sd">    super(self, CarWithTyres).__init__(code, color, doors)</span>
<span class="sd">    tyres = tyres or Tyre(&quot;Pirelli&quot;, &quot;PZERO&quot;)</span>


<span class="sd">class Tyre(object):</span>
<span class="sd">  def __init__(self, brand, code):</span>
<span class="sd">    self.brand = brand</span>
<span class="sd">    self.code = code</span>

<span class="sd">And two new instances:</span>
<span class="sd">  ford_ka = CarWithTyres(&quot;FORDKA&quot;, color=&quot;grey&quot;, tyres=Tyre(&quot;AVON&quot;, &quot;ZT5&quot;))</span>
<span class="sd">  toyota_corolla = Car(&quot;COROLLA1&quot;, color=&quot;white&quot;, doors=5)</span>
<span class="sd">  fleet = [ford_ka, toyota_corolla]</span>

<span class="sd">To filter a car based on the tyre brand, we would use a search path of</span>
<span class="sd">&quot;tyres.brand&quot;.</span>

<span class="sd">Because the filter implementation provides the actual classes that perform</span>
<span class="sd">handling of the search paths, operators, etc. customizing the behaviour of the</span>
<span class="sd">filter is easy. Three basic filter implementations are given:</span>

<span class="sd">  BaseFilterImplementation: search path expansion is done on attribute names</span>
<span class="sd">  as provided (case-sensitive).</span>
<span class="sd">  LowercaseAttributeFilterImp: search path expansion is done on the lowercased</span>
<span class="sd">  attribute name, so that it only accesses attributes, not methods.</span>
<span class="sd">  DictFilterImplementation: search path expansion is done on dictionary access</span>
<span class="sd">  to the given object. So &quot;a.b&quot; expands the object obj to obj[&quot;a&quot;][&quot;b&quot;]</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">plaso.lib</span> <span class="kn">import</span> <span class="n">errors</span>
<span class="kn">from</span> <span class="nn">plaso.lib</span> <span class="kn">import</span> <span class="n">lexer</span>
<span class="kn">from</span> <span class="nn">plaso.lib</span> <span class="kn">import</span> <span class="n">py2to3</span>
<span class="kn">from</span> <span class="nn">plaso.lib</span> <span class="kn">import</span> <span class="n">utils</span>


<span class="c1"># pylint: disable=attribute-defined-outside-init</span>
<span class="c1"># pylint: disable=missing-docstring</span>

<div class="viewcode-block" id="InvalidNumberOfOperands"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.InvalidNumberOfOperands">[docs]</a><span class="k">class</span> <span class="nc">InvalidNumberOfOperands</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;The number of operands provided to this operator is wrong.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Filter"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Filter">[docs]</a><span class="k">class</span> <span class="nc">Filter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Base class for every filter.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">value_expander</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">      arguments: Arguments to the filter.</span>
<span class="sd">      value_expander: A callable that will be used to expand values for the</span>
<span class="sd">      objects passed to this filter. Implementations expanders are provided by</span>
<span class="sd">      subclassing ValueExpander.</span>

<span class="sd">    Raises:</span>
<span class="sd">      ValueError: If the given value_expander is not a subclass of ValueExpander</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value_expander</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value_expander_cls</span> <span class="o">=</span> <span class="n">value_expander</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_expander_cls</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_expander_cls</span><span class="p">,</span> <span class="n">ValueExpander</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">u&#39;{0:s} is not a valid value expander&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_expander_cls</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">value_expander</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_expander_cls</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">arguments</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">u&#39;Adding {0:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="p">))</span>

  <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="Filter.Matches"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Filter.Matches">[docs]</a>  <span class="k">def</span> <span class="nf">Matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Whether object obj matches this filter.&quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="Filter.Filter"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Filter.Filter">[docs]</a>  <span class="k">def</span> <span class="nf">Filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objects</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a list of objects that pass the filter.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Matches</span><span class="p">,</span> <span class="n">objects</span><span class="p">)</span></div>

  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;{0:s}({1:s})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]))</span></div>


<div class="viewcode-block" id="AndFilter"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.AndFilter">[docs]</a><span class="k">class</span> <span class="nc">AndFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Performs a boolean AND of the given Filter instances as arguments.</span>

<span class="sd">    Note that if no conditions are passed, all objects will pass.</span>
<span class="sd">  &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AndFilter.Matches"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.AndFilter.Matches">[docs]</a>  <span class="k">def</span> <span class="nf">Matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">child_filter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">child_filter</span><span class="o">.</span><span class="n">Matches</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span></div></div>


<div class="viewcode-block" id="OrFilter"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.OrFilter">[docs]</a><span class="k">class</span> <span class="nc">OrFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Performs a boolean OR of the given Filter instances as arguments.</span>

<span class="sd">  Note that if no conditions are passed, all objects will pass.</span>
<span class="sd">  &quot;&quot;&quot;</span>
<div class="viewcode-block" id="OrFilter.Matches"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.OrFilter.Matches">[docs]</a>  <span class="k">def</span> <span class="nf">Matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">True</span>

    <span class="k">for</span> <span class="n">child_filter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">child_filter</span><span class="o">.</span><span class="n">Matches</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span></div></div>


<span class="c1"># pylint: disable=abstract-method</span>
<div class="viewcode-block" id="Operator"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Operator">[docs]</a><span class="k">class</span> <span class="nc">Operator</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Base class for all operators.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="IdentityFilter"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.IdentityFilter">[docs]</a><span class="k">class</span> <span class="nc">IdentityFilter</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
<div class="viewcode-block" id="IdentityFilter.Matches"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.IdentityFilter.Matches">[docs]</a>  <span class="k">def</span> <span class="nf">Matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">True</span></div></div>


<div class="viewcode-block" id="UnaryOperator"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.UnaryOperator">[docs]</a><span class="k">class</span> <span class="nc">UnaryOperator</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Base class for unary operators.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operand</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor.&quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">UnaryOperator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="p">[</span><span class="n">operand</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">InvalidNumberOfOperands</span><span class="p">(</span>
          <span class="s1">u&#39;Only one operand is accepted by {0:s}. Received {1:d}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)))</span></div>


<div class="viewcode-block" id="BinaryOperator"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.BinaryOperator">[docs]</a><span class="k">class</span> <span class="nc">BinaryOperator</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Base class for binary operators.</span>

<span class="sd">  The left operand is always a path into the object which will be expanded for</span>
<span class="sd">  values. The right operand is a value defined at initialization and is stored</span>
<span class="sd">  at self.right_operand.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">InvalidNumberOfOperands</span><span class="p">(</span>
          <span class="s1">u&#39;Only two operands are accepted by {0:s}. Received {1:s}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">left_operand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_operand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="GenericBinaryOperator"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.GenericBinaryOperator">[docs]</a><span class="k">class</span> <span class="nc">GenericBinaryOperator</span><span class="p">(</span><span class="n">BinaryOperator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Allows easy implementations of operators.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">GenericBinaryOperator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bool_value</span> <span class="o">=</span> <span class="bp">True</span>

<div class="viewcode-block" id="GenericBinaryOperator.FlipBool"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.GenericBinaryOperator.FlipBool">[docs]</a>  <span class="k">def</span> <span class="nf">FlipBool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">u&#39;Negative matching.&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bool_value</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_value</span></div>

<div class="viewcode-block" id="GenericBinaryOperator.Operation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.GenericBinaryOperator.Operation">[docs]</a>  <span class="k">def</span> <span class="nf">Operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Performs the operation between two values.&quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="GenericBinaryOperator.Operate"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.GenericBinaryOperator.Operate">[docs]</a>  <span class="k">def</span> <span class="nf">Operate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Takes a list of values and if at least one matches, returns True.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Operation</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_operand</span><span class="p">):</span>
          <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">continue</span>
      <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="GenericBinaryOperator.Matches"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.GenericBinaryOperator.Matches">[docs]</a>  <span class="k">def</span> <span class="nf">Matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_operand</span>
    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_expander</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">values</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Operate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_value</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_value</span></div></div>


<div class="viewcode-block" id="Equals"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Equals">[docs]</a><span class="k">class</span> <span class="nc">Equals</span><span class="p">(</span><span class="n">GenericBinaryOperator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Matches objects when the right operand equals the expanded value.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Equals.Operation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Equals.Operation">[docs]</a>  <span class="k">def</span> <span class="nf">Operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span></div></div>


<div class="viewcode-block" id="NotEquals"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.NotEquals">[docs]</a><span class="k">class</span> <span class="nc">NotEquals</span><span class="p">(</span><span class="n">Equals</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Matches when the right operand isn&#39;t equal to the expanded value.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">NotEquals</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bool_value</span> <span class="o">=</span> <span class="bp">False</span></div>


<div class="viewcode-block" id="Less"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Less">[docs]</a><span class="k">class</span> <span class="nc">Less</span><span class="p">(</span><span class="n">GenericBinaryOperator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Whether the expanded value &gt;= right_operand.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Less.Operation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Less.Operation">[docs]</a>  <span class="k">def</span> <span class="nf">Operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span></div></div>


<div class="viewcode-block" id="LessEqual"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.LessEqual">[docs]</a><span class="k">class</span> <span class="nc">LessEqual</span><span class="p">(</span><span class="n">GenericBinaryOperator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Whether the expanded value &lt;= right_operand.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="LessEqual.Operation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.LessEqual.Operation">[docs]</a>  <span class="k">def</span> <span class="nf">Operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">y</span></div></div>


<div class="viewcode-block" id="Greater"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Greater">[docs]</a><span class="k">class</span> <span class="nc">Greater</span><span class="p">(</span><span class="n">GenericBinaryOperator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Whether the expanded value &gt; right_operand.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Greater.Operation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Greater.Operation">[docs]</a>  <span class="k">def</span> <span class="nf">Operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span></div></div>


<div class="viewcode-block" id="GreaterEqual"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.GreaterEqual">[docs]</a><span class="k">class</span> <span class="nc">GreaterEqual</span><span class="p">(</span><span class="n">GenericBinaryOperator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Whether the expanded value &gt;= right_operand.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="GreaterEqual.Operation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.GreaterEqual.Operation">[docs]</a>  <span class="k">def</span> <span class="nf">Operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">y</span></div></div>


<div class="viewcode-block" id="Contains"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Contains">[docs]</a><span class="k">class</span> <span class="nc">Contains</span><span class="p">(</span><span class="n">GenericBinaryOperator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Whether the right operand is contained in the value.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Contains.Operation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Contains.Operation">[docs]</a>  <span class="k">def</span> <span class="nf">Operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">py2to3</span><span class="o">.</span><span class="n">STRING_TYPES</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">y</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span></div></div>


<div class="viewcode-block" id="InSet"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.InSet">[docs]</a><span class="k">class</span> <span class="nc">InSet</span><span class="p">(</span><span class="n">GenericBinaryOperator</span><span class="p">):</span>
  <span class="c1"># TODO(user): Change to an N-ary Operator?</span>
  <span class="sd">&quot;&quot;&quot;Whether all values are contained within the right operand.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="InSet.Operation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.InSet.Operation">[docs]</a>  <span class="k">def</span> <span class="nf">Operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Whether x is fully contained in y.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">True</span>

    <span class="c1"># x might be an iterable</span>
    <span class="c1"># first we need to skip strings or we&#39;ll do silly things</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">py2to3</span><span class="o">.</span><span class="n">STRING_TYPES</span><span class="p">)</span>
        <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
      <span class="k">return</span> <span class="bp">False</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
          <span class="k">return</span> <span class="bp">False</span>
      <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">False</span></div></div>


<div class="viewcode-block" id="Regexp"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Regexp">[docs]</a><span class="k">class</span> <span class="nc">Regexp</span><span class="p">(</span><span class="n">GenericBinaryOperator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Whether the value matches the regexp in the right operand.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">children</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Regexp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">children</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># Note that right_operand is not necessarily a string.</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">u&#39;Compiled: {0!s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_operand</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">compiled_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
          <span class="n">utils</span><span class="o">.</span><span class="n">GetUnicodeString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_operand</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">u&#39;Regular expression &quot;{0!s}&quot; is malformed.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">right_operand</span><span class="p">))</span>

<div class="viewcode-block" id="Regexp.Operation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Regexp.Operation">[docs]</a>  <span class="k">def</span> <span class="nf">Operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">unused_y</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">GetUnicodeString</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
      <span class="k">pass</span>

    <span class="k">return</span> <span class="bp">False</span></div></div>


<div class="viewcode-block" id="RegexpInsensitive"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.RegexpInsensitive">[docs]</a><span class="k">class</span> <span class="nc">RegexpInsensitive</span><span class="p">(</span><span class="n">Regexp</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Whether the value matches the regexp in the right operand.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">children</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">RegexpInsensitive</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">children</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># Note that right_operand is not necessarily a string.</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">u&#39;Compiled: {0!s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_operand</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">compiled_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">GetUnicodeString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_operand</span><span class="p">),</span>
                                    <span class="n">re</span><span class="o">.</span><span class="n">I</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">u&#39;Regular expression &quot;{0!s}&quot; is malformed.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">right_operand</span><span class="p">))</span></div>


<div class="viewcode-block" id="Context"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Context">[docs]</a><span class="k">class</span> <span class="nc">Context</span><span class="p">(</span><span class="n">Operator</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Restricts the child operators to a specific context within the object.</span>

<span class="sd">  Solves the context problem. The context problem is the following:</span>
<span class="sd">  Suppose you store a list of loaded DLLs within a process. Suppose that for</span>
<span class="sd">  each of these DLLs you store the number of imported functions and each of the</span>
<span class="sd">  imported functions name.</span>

<span class="sd">  Imagine that a malicious DLL is injected into processes and its indicators are</span>
<span class="sd">  that it only imports one function and that it is RegQueryValueEx. You&#39;d write</span>
<span class="sd">  your indicator like this:</span>


<span class="sd">  AndOperator(</span>
<span class="sd">    Equal(&quot;ImportedDLLs.ImpFunctions.Name&quot;, &quot;RegQueryValueEx&quot;),</span>
<span class="sd">    Equal(&quot;ImportedDLLs.NumImpFunctions&quot;, &quot;1&quot;)</span>
<span class="sd">    )</span>

<span class="sd">  Now imagine you have these two processes on a given system.</span>

<span class="sd">  Process1</span>
<span class="sd">  * __ImportedDlls</span>

<span class="sd">    * __Name: &quot;notevil.dll&quot;</span>

<span class="sd">      * __ImpFunctions</span>

<span class="sd">        * __Name: &quot;CreateFileA&quot;</span>

<span class="sd">      * __NumImpFunctions: 1</span>

<span class="sd">    * __Name: &quot;alsonotevil.dll&quot;</span>

<span class="sd">      * __ImpFunctions</span>

<span class="sd">        * __Name: &quot;RegQueryValueEx&quot;</span>
<span class="sd">        * __Name: &quot;CreateFileA&quot;</span>

<span class="sd">      * __NumImpFunctions: 2</span>

<span class="sd">  Process2</span>
<span class="sd">  * __ImportedDlls</span>

<span class="sd">    * __Name: &quot;evil.dll&quot;</span>

<span class="sd">      * __ImpFunctions</span>

<span class="sd">        * __Name: &quot;RegQueryValueEx&quot;</span>

<span class="sd">      * __NumImpFunctions: 1</span>

<span class="sd">  Both Process1 and Process2 match your query, as each of the indicators are</span>
<span class="sd">  evaluated separately. While you wanted to express &quot;find me processes that</span>
<span class="sd">  have a DLL that has both one imported function and ReqQueryValueEx is in the</span>
<span class="sd">  list of imported functions&quot;, your indicator actually means &quot;find processes</span>
<span class="sd">  that have at least a DLL with 1 imported functions and at least one DLL that</span>
<span class="sd">  imports the ReqQueryValueEx function&quot;.</span>

<span class="sd">  To write such an indicator you need to specify a context of ImportedDLLs for</span>
<span class="sd">  these two clauses. Such that you convert your indicator to::</span>

<span class="sd">      Context(&quot;ImportedDLLs&quot;,</span>
<span class="sd">              AndOperator(</span>
<span class="sd">                Equal(&quot;ImpFunctions.Name&quot;, &quot;RegQueryValueEx&quot;),</span>
<span class="sd">                Equal(&quot;NumImpFunctions&quot;, &quot;1&quot;)</span>
<span class="sd">              ))</span>

<span class="sd">  Context will execute the filter specified as the second parameter for each of</span>
<span class="sd">  the objects under &quot;ImportedDLLs&quot;, thus applying the condition per DLL, not per</span>
<span class="sd">  object and returning the right result.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">InvalidNumberOfOperands</span><span class="p">(</span><span class="s1">u&#39;Context accepts only 2 operands.&#39;</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Context</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>

<div class="viewcode-block" id="Context.Matches"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Context.Matches">[docs]</a>  <span class="k">def</span> <span class="nf">Matches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">object_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_expander</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">sub_object</span> <span class="ow">in</span> <span class="n">object_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="o">.</span><span class="n">Matches</span><span class="p">(</span><span class="n">sub_object</span><span class="p">):</span>
          <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span></div></div>


<span class="n">OP2FN</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;equals&#39;</span><span class="p">:</span> <span class="n">Equals</span><span class="p">,</span>
    <span class="s1">&#39;is&#39;</span><span class="p">:</span> <span class="n">Equals</span><span class="p">,</span>
    <span class="s1">&#39;==&#39;</span><span class="p">:</span> <span class="n">Equals</span><span class="p">,</span>
    <span class="s1">&#39;!=&#39;</span><span class="p">:</span> <span class="n">NotEquals</span><span class="p">,</span>
    <span class="s1">&#39;contains&#39;</span><span class="p">:</span> <span class="n">Contains</span><span class="p">,</span>
    <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span> <span class="n">Greater</span><span class="p">,</span>
    <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span> <span class="n">GreaterEqual</span><span class="p">,</span>
    <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span> <span class="n">Less</span><span class="p">,</span>
    <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span> <span class="n">LessEqual</span><span class="p">,</span>
    <span class="s1">&#39;inset&#39;</span><span class="p">:</span> <span class="n">InSet</span><span class="p">,</span>
    <span class="s1">&#39;regexp&#39;</span><span class="p">:</span> <span class="n">Regexp</span><span class="p">,</span>
    <span class="s1">&#39;iregexp&#39;</span><span class="p">:</span> <span class="n">RegexpInsensitive</span><span class="p">}</span>


<div class="viewcode-block" id="ValueExpander"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.ValueExpander">[docs]</a><span class="k">class</span> <span class="nc">ValueExpander</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Encapsulates the logic to expand values available in an object.</span>

<span class="sd">  Once instantiated and called, this class returns all the values that follow a</span>
<span class="sd">  given field path.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="n">FIELD_SEPARATOR</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>

  <span class="k">def</span> <span class="nf">_GetAttributeName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the attribute name to fetch given a path.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">_GetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused_obj</span><span class="p">,</span> <span class="n">unused_attr_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the value of tha attribute attr_name.&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_AtLeaf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Called when at a leaf value. Should yield a value.&quot;&quot;&quot;</span>
    <span class="k">yield</span> <span class="n">attr_value</span>

  <span class="k">def</span> <span class="nf">_AtNonLeaf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Called when at a non-leaf value. Should recurse and yield values.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="c1"># Check first for iterables</span>
      <span class="c1"># If it&#39;s a dictionary, we yield it</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">attr_value</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If it&#39;s an iterable, we recurse on each value.</span>
        <span class="k">for</span> <span class="n">sub_obj</span> <span class="ow">in</span> <span class="n">attr_value</span><span class="p">:</span>
          <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">sub_obj</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="k">yield</span> <span class="n">value</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>  <span class="c1"># This is then not iterable, we recurse with the value</span>
      <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="k">yield</span> <span class="n">value</span>

<div class="viewcode-block" id="ValueExpander.Expand"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.ValueExpander.Expand">[docs]</a>  <span class="k">def</span> <span class="nf">Expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a list of all the values for the given path in the object obj.</span>

<span class="sd">    Given a path such as [&quot;sub1&quot;, &quot;sub2&quot;] it returns all the values available</span>
<span class="sd">    in obj.sub1.sub2 as a list. sub1 and sub2 must be data attributes or</span>
<span class="sd">    properties.</span>

<span class="sd">    If sub1 returns a list of objects, or a generator, Expand aggregates the</span>
<span class="sd">    values for the remaining path for each of the objects, thus returning a</span>
<span class="sd">    list of all the values under the given path for the input object.</span>

<span class="sd">    Args:</span>
<span class="sd">      obj: An object that will be traversed for the given path</span>
<span class="sd">      path: A list of strings</span>

<span class="sd">    Yields:</span>
<span class="sd">      The values once the object is traversed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">py2to3</span><span class="o">.</span><span class="n">STRING_TYPES</span><span class="p">):</span>
      <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FIELD_SEPARATOR</span><span class="p">)</span>

    <span class="n">attr_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GetAttributeName</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">attr_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GetValue</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">attr_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AtLeaf</span><span class="p">(</span><span class="n">attr_value</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_AtNonLeaf</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="AttributeValueExpander"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.AttributeValueExpander">[docs]</a><span class="k">class</span> <span class="nc">AttributeValueExpander</span><span class="p">(</span><span class="n">ValueExpander</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;An expander that gives values based on object attribute names.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">_GetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="LowercaseAttributeValueExpander"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.LowercaseAttributeValueExpander">[docs]</a><span class="k">class</span> <span class="nc">LowercaseAttributeValueExpander</span><span class="p">(</span><span class="n">AttributeValueExpander</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;An expander that lowercases all attribute names before access.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">_GetAttributeName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span></div>


<div class="viewcode-block" id="DictValueExpander"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.DictValueExpander">[docs]</a><span class="k">class</span> <span class="nc">DictValueExpander</span><span class="p">(</span><span class="n">ValueExpander</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;An expander that gets values from dictionary access to the object.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">_GetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="BasicExpression"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.BasicExpression">[docs]</a><span class="k">class</span> <span class="nc">BasicExpression</span><span class="p">(</span><span class="n">lexer</span><span class="o">.</span><span class="n">Expression</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Basic Expression.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">BasicExpression</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bool_value</span> <span class="o">=</span> <span class="bp">True</span>

<div class="viewcode-block" id="BasicExpression.FlipBool"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.BasicExpression.FlipBool">[docs]</a>  <span class="k">def</span> <span class="nf">FlipBool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bool_value</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_value</span></div>

<div class="viewcode-block" id="BasicExpression.Compile"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.BasicExpression.Compile">[docs]</a>  <span class="k">def</span> <span class="nf">Compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_implementation</span><span class="p">):</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attribute</span><span class="p">]</span>
    <span class="n">op_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">operator</span> <span class="o">=</span> <span class="n">filter_implementation</span><span class="o">.</span><span class="n">OPS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">op_str</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">operator</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span><span class="s1">u&#39;Unknown operator {0:s} provided.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="p">))</span>

    <span class="n">arguments</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
    <span class="n">expander</span> <span class="o">=</span> <span class="n">filter_implementation</span><span class="o">.</span><span class="n">FILTERS</span><span class="p">[</span><span class="s1">&#39;ValueExpander&#39;</span><span class="p">]</span>
    <span class="n">ops</span> <span class="o">=</span> <span class="n">operator</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span> <span class="n">value_expander</span><span class="o">=</span><span class="n">expander</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_value</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ops</span><span class="p">,</span> <span class="s1">&#39;FlipBool&#39;</span><span class="p">):</span>
        <span class="n">ops</span><span class="o">.</span><span class="n">FlipBool</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ops</span></div></div>


<div class="viewcode-block" id="ContextExpression"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.ContextExpression">[docs]</a><span class="k">class</span> <span class="nc">ContextExpression</span><span class="p">(</span><span class="n">lexer</span><span class="o">.</span><span class="n">Expression</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Represents the context operator.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">attribute</span> <span class="o">=</span> <span class="n">attribute</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">part</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ContextExpression</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;Context({0:s} {1:s})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>

<div class="viewcode-block" id="ContextExpression.SetExpression"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.ContextExpression.SetExpression">[docs]</a>  <span class="k">def</span> <span class="nf">SetExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the expression.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">lexer</span><span class="o">.</span><span class="n">Expression</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">expression</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span>
          <span class="s1">u&#39;Expected expression, got {0:s}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expression</span><span class="p">))</span></div>

<div class="viewcode-block" id="ContextExpression.Compile"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.ContextExpression.Compile">[docs]</a>  <span class="k">def</span> <span class="nf">Compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_implementation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compile the expression.&quot;&quot;&quot;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attribute</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
      <span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">Compile</span><span class="p">(</span><span class="n">filter_implementation</span><span class="p">))</span>
    <span class="n">expander</span> <span class="o">=</span> <span class="n">filter_implementation</span><span class="o">.</span><span class="n">FILTERS</span><span class="p">[</span><span class="s1">&#39;ValueExpander&#39;</span><span class="p">]</span>
    <span class="n">context_cls</span> <span class="o">=</span> <span class="n">filter_implementation</span><span class="o">.</span><span class="n">FILTERS</span><span class="p">[</span><span class="s1">&#39;Context&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">context_cls</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span>
                       <span class="n">value_expander</span><span class="o">=</span><span class="n">expander</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="BinaryExpression"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.BinaryExpression">[docs]</a><span class="k">class</span> <span class="nc">BinaryExpression</span><span class="p">(</span><span class="n">lexer</span><span class="o">.</span><span class="n">BinaryExpression</span><span class="p">):</span>
<div class="viewcode-block" id="BinaryExpression.Compile"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.BinaryExpression.Compile">[docs]</a>  <span class="k">def</span> <span class="nf">Compile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_implementation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compile the binary expression into a filter object.&quot;&quot;&quot;</span>
    <span class="n">operator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;and&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&amp;&amp;&#39;</span><span class="p">:</span>
      <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;AndFilter&#39;</span>
    <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;or&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;||&#39;</span><span class="p">:</span>
      <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;OrFilter&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span>
          <span class="s1">u&#39;Invalid binary operator {0:s}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operator</span><span class="p">))</span>

    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">Compile</span><span class="p">(</span><span class="n">filter_implementation</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">filter_implementation</span><span class="o">.</span><span class="n">FILTERS</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="n">arguments</span><span class="o">=</span><span class="n">args</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Parser"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser">[docs]</a><span class="k">class</span> <span class="nc">Parser</span><span class="p">(</span><span class="n">lexer</span><span class="o">.</span><span class="n">SearchParser</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Parses and generates an AST for a query written in the described language.</span>

<span class="sd">  Examples of valid syntax:</span>
<span class="sd">    size is 40</span>
<span class="sd">    (name contains &quot;Program Files&quot; AND hash.md5 is &quot;123abc&quot;)</span>
<span class="sd">    @imported_modules (num_symbols = 14 AND symbol.name is &quot;FindWindow&quot;)</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">expression_cls</span> <span class="o">=</span> <span class="n">BasicExpression</span>
  <span class="n">binary_expression_cls</span> <span class="o">=</span> <span class="n">BinaryExpression</span>
  <span class="n">context_cls</span> <span class="o">=</span> <span class="n">ContextExpression</span>

  <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span>
      <span class="c1"># Operators and related tokens</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;INITIAL&#39;</span><span class="p">,</span> <span class="s1">r&#39;\@[\w._0-9]+&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;ContextOperator,PushState&#39;</span><span class="p">,</span> <span class="s1">&#39;CONTEXTOPEN&#39;</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;INITIAL&#39;</span><span class="p">,</span> <span class="s1">r&#39;[^\s\(\)]&#39;</span><span class="p">,</span> <span class="s1">&#39;PushState,PushBack&#39;</span><span class="p">,</span> <span class="s1">&#39;ATTRIBUTE&#39;</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;INITIAL&#39;</span><span class="p">,</span> <span class="s1">r&#39;\(&#39;</span><span class="p">,</span> <span class="s1">&#39;PushState,BracketOpen&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;INITIAL&#39;</span><span class="p">,</span> <span class="s1">r&#39;\)&#39;</span><span class="p">,</span> <span class="s1">&#39;BracketClose&#39;</span><span class="p">,</span> <span class="s1">&#39;BINARY&#39;</span><span class="p">),</span>

      <span class="c1"># Context</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;CONTEXTOPEN&#39;</span><span class="p">,</span> <span class="s1">r&#39;\(&#39;</span><span class="p">,</span> <span class="s1">&#39;BracketOpen&#39;</span><span class="p">,</span> <span class="s1">&#39;INITIAL&#39;</span><span class="p">),</span>

      <span class="c1"># Double quoted string</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;PopState,StringFinish&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="s1">r&#39;</span><span class="se">\\</span><span class="s1">x(..)&#39;</span><span class="p">,</span> <span class="s1">&#39;HexEscape&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="s1">r&#39;</span><span class="se">\\</span><span class="s1">(.)&#39;</span><span class="p">,</span> <span class="s1">&#39;StringEscape&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;STRING&#39;</span><span class="p">,</span> <span class="s1">r&#39;[^</span><span class="se">\\</span><span class="s1">&quot;]+&#39;</span><span class="p">,</span> <span class="s1">&#39;StringInsert&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>

      <span class="c1"># Single quoted string</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;SQ_STRING&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;PopState,StringFinish&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;SQ_STRING&#39;</span><span class="p">,</span> <span class="s1">r&#39;</span><span class="se">\\</span><span class="s1">x(..)&#39;</span><span class="p">,</span> <span class="s1">&#39;HexEscape&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;SQ_STRING&#39;</span><span class="p">,</span> <span class="s1">r&#39;</span><span class="se">\\</span><span class="s1">(.)&#39;</span><span class="p">,</span> <span class="s1">&#39;StringEscape&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;SQ_STRING&#39;</span><span class="p">,</span> <span class="s1">r&#39;[^</span><span class="se">\\\&#39;</span><span class="s1">]+&#39;</span><span class="p">,</span> <span class="s1">&#39;StringInsert&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>

      <span class="c1"># Basic expression</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;ATTRIBUTE&#39;</span><span class="p">,</span> <span class="s1">r&#39;[\w._0-9]+&#39;</span><span class="p">,</span> <span class="s1">&#39;StoreAttribute&#39;</span><span class="p">,</span> <span class="s1">&#39;OPERATOR&#39;</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;OPERATOR&#39;</span><span class="p">,</span> <span class="s1">r&#39;not &#39;</span><span class="p">,</span> <span class="s1">&#39;FlipLogic&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;OPERATOR&#39;</span><span class="p">,</span> <span class="s1">r&#39;(\w+|[&lt;&gt;!=]=?)&#39;</span><span class="p">,</span> <span class="s1">&#39;StoreOperator&#39;</span><span class="p">,</span> <span class="s1">&#39;CHECKNOT&#39;</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;CHECKNOT&#39;</span><span class="p">,</span> <span class="s1">r&#39;not&#39;</span><span class="p">,</span> <span class="s1">&#39;FlipLogic&#39;</span><span class="p">,</span> <span class="s1">&#39;ARG&#39;</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;CHECKNOT&#39;</span><span class="p">,</span> <span class="s1">r&#39;\s+&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;CHECKNOT&#39;</span><span class="p">,</span> <span class="s1">r&#39;([^not])&#39;</span><span class="p">,</span> <span class="s1">&#39;PushBack&#39;</span><span class="p">,</span> <span class="s1">&#39;ARG&#39;</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;ARG&#39;</span><span class="p">,</span> <span class="s1">r&#39;(\d+\.\d+)&#39;</span><span class="p">,</span> <span class="s1">&#39;InsertFloatArg&#39;</span><span class="p">,</span> <span class="s1">&#39;ARG&#39;</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;ARG&#39;</span><span class="p">,</span> <span class="s1">r&#39;(0x\d+)&#39;</span><span class="p">,</span> <span class="s1">&#39;InsertInt16Arg&#39;</span><span class="p">,</span> <span class="s1">&#39;ARG&#39;</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;ARG&#39;</span><span class="p">,</span> <span class="s1">r&#39;(\d+)&#39;</span><span class="p">,</span> <span class="s1">&#39;InsertIntArg&#39;</span><span class="p">,</span> <span class="s1">&#39;ARG&#39;</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;ARG&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;PushState,StringStart&#39;</span><span class="p">,</span> <span class="s1">&#39;STRING&#39;</span><span class="p">),</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;ARG&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;PushState,StringStart&#39;</span><span class="p">,</span> <span class="s1">&#39;SQ_STRING&#39;</span><span class="p">),</span>
      <span class="c1"># When the last parameter from arg_list has been pushed</span>

      <span class="c1"># State where binary operators are supported (AND, OR)</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;BINARY&#39;</span><span class="p">,</span> <span class="s1">r&#39;(?i)(and|or|\&amp;\&amp;|\|\|)&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;BinaryOperator&#39;</span><span class="p">,</span> <span class="s1">&#39;INITIAL&#39;</span><span class="p">),</span>
      <span class="c1"># - We can also skip spaces</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;BINARY&#39;</span><span class="p">,</span> <span class="s1">r&#39;\s+&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
      <span class="c1"># - But if it&#39;s not &quot;and&quot; or just spaces we have to go back</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;BINARY&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;PushBack,PopState&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>

      <span class="c1"># Skip whitespace.</span>
      <span class="n">lexer</span><span class="o">.</span><span class="n">Token</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">r&#39;\s+&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
      <span class="p">]</span>

<div class="viewcode-block" id="Parser.StoreAttribute"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.StoreAttribute">[docs]</a>  <span class="k">def</span> <span class="nf">StoreAttribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flipped</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Parser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">StoreAttribute</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.FlipAllowed"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.FlipAllowed">[docs]</a>  <span class="k">def</span> <span class="nf">FlipAllowed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise an error if the not keyword is used where it is not allowed.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;flipped&#39;</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span><span class="s1">u&#39;Not defined.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipped</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_expression</span><span class="o">.</span><span class="n">operator</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_expression</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span>
          <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;contains&#39;</span><span class="p">,</span> <span class="s1">&#39;inset&#39;</span><span class="p">,</span> <span class="s1">&#39;equals&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span>
            <span class="s1">u&#39;Keyword </span><span class="se">\&#39;</span><span class="s1">not</span><span class="se">\&#39;</span><span class="s1"> does not work against operator: {0:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_expression</span><span class="o">.</span><span class="n">operator</span><span class="p">))</span></div>

<div class="viewcode-block" id="Parser.FlipLogic"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.FlipLogic">[docs]</a>  <span class="k">def</span> <span class="nf">FlipLogic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Flip the boolean logic of the expression.</span>

<span class="sd">    If an expression is configured to return True when the condition</span>
<span class="sd">    is met this logic will flip that to False, and vice versa.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;flipped&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipped</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span>
          <span class="s1">u&#39;The operator </span><span class="se">\&#39;</span><span class="s1">not</span><span class="se">\&#39;</span><span class="s1"> can only be expressed once.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_expression</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span>
          <span class="s1">u&#39;Unable to place the keyword </span><span class="se">\&#39;</span><span class="s1">not</span><span class="se">\&#39;</span><span class="s1"> after an argument.&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">flipped</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1"># Check if this flip operation should be allowed.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">FlipAllowed</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_expression</span><span class="p">,</span> <span class="s1">&#39;FlipBool&#39;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">current_expression</span><span class="o">.</span><span class="n">FlipBool</span><span class="p">()</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">u&#39;Negative matching [flipping boolean logic].&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
          <span class="s1">u&#39;Unable to perform a negative match, issuing a positive one.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.InsertArg"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.InsertArg">[docs]</a>  <span class="k">def</span> <span class="nf">InsertArg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Insert an arg to the current expression.&quot;&quot;&quot;</span>
    <span class="c1"># Note that &quot;string&quot; is not necessarily of type string.</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">u&#39;Storing argument: {0!s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>

    <span class="c1"># Check if this flip operation should be allowed.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">FlipAllowed</span><span class="p">()</span>

    <span class="c1"># This expression is complete</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_expression</span><span class="o">.</span><span class="n">AddArg</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_expression</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">current_expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expression_cls</span><span class="p">()</span>
      <span class="c1"># We go to the BINARY state, to find if there&#39;s an AND or OR operator</span>
      <span class="k">return</span> <span class="s1">&#39;BINARY&#39;</span></div>

<div class="viewcode-block" id="Parser.InsertFloatArg"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.InsertFloatArg">[docs]</a>  <span class="k">def</span> <span class="nf">InsertFloatArg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Inserts a Float argument.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">float_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span><span class="s1">u&#39;{0:s} is not a valid float.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">InsertArg</span><span class="p">(</span><span class="n">float_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.InsertIntArg"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.InsertIntArg">[docs]</a>  <span class="k">def</span> <span class="nf">InsertIntArg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Inserts an Integer argument.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">int_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span><span class="s1">u&#39;{0:s} is not a valid integer.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">InsertArg</span><span class="p">(</span><span class="n">int_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.InsertInt16Arg"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.InsertInt16Arg">[docs]</a>  <span class="k">def</span> <span class="nf">InsertInt16Arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Inserts an Integer in base16 argument.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">int_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span>
          <span class="s1">u&#39;{0:s} is not a valid base16 integer.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">InsertArg</span><span class="p">(</span><span class="n">int_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.StringFinish"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.StringFinish">[docs]</a>  <span class="k">def</span> <span class="nf">StringFinish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;ATTRIBUTE&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">StoreAttribute</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;ARG&#39;</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">InsertArg</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.StringEscape"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.StringEscape">[docs]</a>  <span class="k">def</span> <span class="nf">StringEscape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Escape backslashes found inside a string quote.</span>

<span class="sd">    Backslashes followed by anything other than [\&#39;&quot;rnbt.ws] will raise</span>
<span class="sd">    an Error.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: The string that matched.</span>
<span class="sd">      match: the match object (instance of re.MatchObject).</span>
<span class="sd">             Where match.group(1) contains the escaped code.</span>

<span class="sd">    Raises:</span>
<span class="sd">      ParseError: When the escaped string is not one of [\&#39;&quot;rnbt]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="s1">&#39;</span><span class="se">\\\&#39;</span><span class="s1">&quot;rnbt</span><span class="se">\\</span><span class="s1">.ws&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">+=</span> <span class="n">string</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;string_escape&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span><span class="s1">u&#39;Invalid escape character {0:s}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span></div>

<div class="viewcode-block" id="Parser.HexEscape"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.HexEscape">[docs]</a>  <span class="k">def</span> <span class="nf">HexEscape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts a hex escaped string.&quot;&quot;&quot;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">u&#39;HexEscape matched {0:s}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
    <span class="n">hex_string</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">+=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">hex_string</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span><span class="s1">u&#39;Invalid hex escape {0:s}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string</span><span class="p">))</span></div>

<div class="viewcode-block" id="Parser.ContextOperator"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.ContextOperator">[docs]</a>  <span class="k">def</span> <span class="nf">ContextOperator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context_cls</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span></div>

<div class="viewcode-block" id="Parser.Reduce"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.Reduce">[docs]</a>  <span class="k">def</span> <span class="nf">Reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reduce the token stack into an AST.&quot;&quot;&quot;</span>
    <span class="c1"># Check for sanity</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="s1">&#39;INITIAL&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="s1">&#39;BINARY&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s1">u&#39;Premature end of expression&#39;</span><span class="p">)</span>

    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="c1"># Precendence order</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_CombineParenthesis</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_CombineBinaryExpressions</span><span class="p">(</span><span class="s1">&#39;and&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_CombineBinaryExpressions</span><span class="p">(</span><span class="s1">&#39;or&#39;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_CombineContext</span><span class="p">()</span>

      <span class="c1"># No change</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="n">length</span><span class="p">:</span>
        <span class="k">break</span>
      <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s1">u&#39;Illegal query expression&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Parser.Error"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.Parser.Error">[docs]</a>  <span class="k">def</span> <span class="nf">Error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1"># Note that none of the values necessarily are strings.</span>
    <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span>
        <span class="s1">u&#39;{0!s} in position {1!s}: {2!s} &lt;----&gt; {3!s} )&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">message</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processed_buffer</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">processed_buffer</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">))</span></div>

  <span class="k">def</span> <span class="nf">_CombineBinaryExpressions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">lexer</span><span class="o">.</span><span class="n">BinaryExpression</span><span class="p">)</span> <span class="ow">and</span>
          <span class="n">item</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">operator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span>
          <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">lexer</span><span class="o">.</span><span class="n">Expression</span><span class="p">)</span> <span class="ow">and</span>
          <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">lexer</span><span class="o">.</span><span class="n">Expression</span><span class="p">)):</span>
        <span class="n">lhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">AddOperands</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_CombineContext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Context can merge from item 0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ContextExpression</span><span class="p">)</span> <span class="ow">and</span>
          <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lexer</span><span class="o">.</span><span class="n">Expression</span><span class="p">)):</span>
        <span class="n">expression</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetExpression</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span></div>


<span class="c1">### FILTER IMPLEMENTATIONS</span>
<div class="viewcode-block" id="BaseFilterImplementation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.BaseFilterImplementation">[docs]</a><span class="k">class</span> <span class="nc">BaseFilterImplementation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Defines the base implementation of an object filter by its attributes.</span>

<span class="sd">  Inherit from this class, switch any of the needed operators and pass it to</span>
<span class="sd">  the Compile method of a parsed string to obtain an executable filter.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="n">OPS</span> <span class="o">=</span> <span class="n">OP2FN</span>
  <span class="n">FILTERS</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;ValueExpander&#39;</span><span class="p">:</span> <span class="n">AttributeValueExpander</span><span class="p">,</span>
      <span class="s1">&#39;AndFilter&#39;</span><span class="p">:</span> <span class="n">AndFilter</span><span class="p">,</span>
      <span class="s1">&#39;OrFilter&#39;</span><span class="p">:</span> <span class="n">OrFilter</span><span class="p">,</span>
      <span class="s1">&#39;IdentityFilter&#39;</span><span class="p">:</span> <span class="n">IdentityFilter</span><span class="p">,</span>
      <span class="s1">&#39;Context&#39;</span><span class="p">:</span> <span class="n">Context</span><span class="p">}</span></div>


<div class="viewcode-block" id="LowercaseAttributeFilterImplementation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.LowercaseAttributeFilterImplementation">[docs]</a><span class="k">class</span> <span class="nc">LowercaseAttributeFilterImplementation</span><span class="p">(</span><span class="n">BaseFilterImplementation</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Does field name access on the lowercase version of names.</span>

<span class="sd">  Useful to only access attributes and properties with Google&#39;s python naming</span>
<span class="sd">  style.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="n">FILTERS</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">FILTERS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">BaseFilterImplementation</span><span class="o">.</span><span class="n">FILTERS</span><span class="p">)</span>
  <span class="n">FILTERS</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ValueExpander&#39;</span><span class="p">:</span> <span class="n">LowercaseAttributeValueExpander</span><span class="p">})</span></div>


<div class="viewcode-block" id="DictFilterImplementation"><a class="viewcode-back" href="../../../plaso.lib.html#plaso.lib.objectfilter.DictFilterImplementation">[docs]</a><span class="k">class</span> <span class="nc">DictFilterImplementation</span><span class="p">(</span><span class="n">BaseFilterImplementation</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Does value fetching by dictionary access on the object.&quot;&quot;&quot;</span>

  <span class="n">FILTERS</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">FILTERS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">BaseFilterImplementation</span><span class="o">.</span><span class="n">FILTERS</span><span class="p">)</span>
  <span class="n">FILTERS</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ValueExpander&#39;</span><span class="p">:</span> <span class="n">DictValueExpander</span><span class="p">})</span></div>


</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Plaso 1.4.1_20160603 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../plaso.html" >plaso</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright The Plaso Project Authors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.2.
    </div>
  </body>
</html>