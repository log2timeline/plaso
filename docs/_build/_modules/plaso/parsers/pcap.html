<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>plaso.parsers.pcap &mdash; Plaso 1.4.1_20160603 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.4.1_20160603',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Plaso 1.4.1_20160603 documentation" href="../../../index.html" />
    <link rel="up" title="plaso" href="../../plaso.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Plaso 1.4.1_20160603 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../plaso.html" accesskey="U">plaso</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for plaso.parsers.pcap</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Parser for PCAP files.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="kn">import</span> <span class="nn">dpkt</span>

<span class="kn">from</span> <span class="nn">plaso.containers</span> <span class="kn">import</span> <span class="n">time_events</span>
<span class="kn">from</span> <span class="nn">plaso.lib</span> <span class="kn">import</span> <span class="n">errors</span>
<span class="kn">from</span> <span class="nn">plaso.lib</span> <span class="kn">import</span> <span class="n">eventdata</span>
<span class="kn">from</span> <span class="nn">plaso.parsers</span> <span class="kn">import</span> <span class="n">interface</span>
<span class="kn">from</span> <span class="nn">plaso.parsers</span> <span class="kn">import</span> <span class="n">manager</span>


<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Dominique Kilman (lexistar97@gmail.com)&#39;</span>


<div class="viewcode-block" id="ParseDNS"><a class="viewcode-back" href="../../../plaso.parsers.html#plaso.parsers.pcap.ParseDNS">[docs]</a><span class="k">def</span> <span class="nf">ParseDNS</span><span class="p">(</span><span class="n">dns_packet_data</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Parse DNS packets and return a string with relevant details.</span>

<span class="sd">  Args:</span>
<span class="sd">    dns_packet_data: DNS packet data.</span>

<span class="sd">  Returns:</span>
<span class="sd">    Formatted DNS details.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">dns_data</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="n">dns</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS</span><span class="p">(</span><span class="n">dns_packet_data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dns</span><span class="o">.</span><span class="n">rcode</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">dns</span><span class="o">.</span><span class="n">DNS_RCODE_NOERR</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">dns</span><span class="o">.</span><span class="n">qr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dns</span><span class="o">.</span><span class="n">an</span><span class="p">:</span>
          <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;DNS Response: No answer for &#39;</span><span class="p">)</span>
          <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dns</span><span class="o">.</span><span class="n">qd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="c1"># Type of DNS answer.</span>
          <span class="k">for</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">dns</span><span class="o">.</span><span class="n">an</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">answer</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;DNS-CNAME request &#39;</span><span class="p">)</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; response: &#39;</span><span class="p">)</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">cname</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">answer</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;DNS-A request &#39;</span><span class="p">)</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; response: &#39;</span><span class="p">)</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">rdata</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">answer</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;DNS-PTR request &#39;</span><span class="p">)</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; response: &#39;</span><span class="p">)</span>
              <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">ptrname</span><span class="p">)</span>
      <span class="k">elif</span> <span class="ow">not</span> <span class="n">dns</span><span class="o">.</span><span class="n">qr</span><span class="p">:</span>
        <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;DNS Query for &#39;</span><span class="p">)</span>
        <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dns</span><span class="o">.</span><span class="n">qd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;DNS error code &#39;</span><span class="p">)</span>
      <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dns</span><span class="o">.</span><span class="n">rcode</span><span class="p">))</span>

  <span class="k">except</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">UnpackError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
    <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;DNS Unpack Error: {0:s}. First 20 of data {1:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">exception</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">dns_packet_data</span><span class="p">[:</span><span class="mi">20</span><span class="p">])))</span>
  <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
    <span class="n">dns_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;DNS Index Error: {0:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span>

  <span class="k">return</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dns_data</span><span class="p">)</span></div>


<div class="viewcode-block" id="ParseNetBios"><a class="viewcode-back" href="../../../plaso.parsers.html#plaso.parsers.pcap.ParseNetBios">[docs]</a><span class="k">def</span> <span class="nf">ParseNetBios</span><span class="p">(</span><span class="n">netbios_packet</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Parse the netBIOS stream details.</span>

<span class="sd">  Args:</span>
<span class="sd">    netbios_packet: NetBIOS packet.</span>

<span class="sd">  Returns:</span>
<span class="sd">     Formatted netBIOS details.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">netbios_data</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">netbios_packet</span><span class="o">.</span><span class="n">qd</span><span class="p">:</span>
    <span class="n">netbios_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;NETBIOS qd:&#39;</span><span class="p">)</span>
    <span class="n">netbios_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">netbios</span><span class="o">.</span><span class="n">decode_name</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
  <span class="k">for</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">netbios_packet</span><span class="o">.</span><span class="n">an</span><span class="p">:</span>
    <span class="n">netbios_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;NETBIOS an:&#39;</span><span class="p">)</span>
    <span class="n">netbios_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">netbios</span><span class="o">.</span><span class="n">decode_name</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
  <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">netbios_packet</span><span class="o">.</span><span class="n">ns</span><span class="p">:</span>
    <span class="n">netbios_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;NETBIOS ns:&#39;</span><span class="p">)</span>
    <span class="n">netbios_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">netbios</span><span class="o">.</span><span class="n">decode_name</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>

  <span class="k">return</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">netbios_data</span><span class="p">)</span></div>


<div class="viewcode-block" id="TCPFlags"><a class="viewcode-back" href="../../../plaso.parsers.html#plaso.parsers.pcap.TCPFlags">[docs]</a><span class="k">def</span> <span class="nf">TCPFlags</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Check the tcp flags for a packet for future use.</span>

<span class="sd">  Args:</span>
<span class="sd">    flag: Flag value from TCP packet.</span>

<span class="sd">  Returns:</span>
<span class="sd">    String with printable flags for specific packet.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_FIN</span><span class="p">:</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;FIN&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_SYN</span><span class="p">:</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;SYN&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_RST</span><span class="p">:</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;RST&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_PUSH</span><span class="p">:</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;PUSH&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_ACK</span><span class="p">:</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ACK&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_URG</span><span class="p">:</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;URG&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_ECE</span><span class="p">:</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ECN&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">flag</span> <span class="o">&amp;</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TH_CWR</span><span class="p">:</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;CWR&#39;</span><span class="p">)</span>

  <span class="k">return</span> <span class="s1">u&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>


<div class="viewcode-block" id="ICMPTypes"><a class="viewcode-back" href="../../../plaso.parsers.html#plaso.parsers.pcap.ICMPTypes">[docs]</a><span class="k">def</span> <span class="nf">ICMPTypes</span><span class="p">(</span><span class="n">packet</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Parse the type information for the icmp packets.</span>

<span class="sd">  Args:</span>
<span class="sd">    packet: ICMP packet data.</span>

<span class="sd">  Returns:</span>
<span class="sd">    Formatted ICMP details.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">icmp_type</span> <span class="o">=</span> <span class="n">packet</span><span class="o">.</span><span class="n">type</span>
  <span class="n">icmp_code</span> <span class="o">=</span> <span class="n">packet</span><span class="o">.</span><span class="n">code</span>
  <span class="n">icmp_data</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP&#39;</span><span class="p">)</span>

  <span class="c1"># TODO: Make the below code more readable.</span>
  <span class="c1"># Possible to use lookup dict? Or method</span>
  <span class="c1"># calls?</span>
  <span class="k">if</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_CODE_NONE</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP without codes&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_ECHOREPLY</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;echo reply&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP dest unreachable&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_NET</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: bad net&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_HOST</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: host unreachable&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_PROTO</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: bad protocol&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_PORT</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: port unreachable&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_NEEDFRAG</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: IP_DF caused drop&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_SRCFAIL</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: src route failed&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_NET_UNKNOWN</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: unknown net&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_HOST_UNKNOWN</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: unknown host&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_ISOLATED</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: src host isolated&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_NET_PROHIB</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: for crypto devs&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_HOST_PROHIB</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: for cypto devs&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_TOSNET</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: bad tos for net&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_TOSHOST</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: bad tos for host&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_FILTER_PROHIB</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: prohibited access&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_HOST_PRECEDENCE</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: precedence error&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_UNREACH_PRECEDENCE_CUTOFF</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: precedence cutoff&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_SRCQUENCH</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP source quench&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_REDIRECT</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP Redirect&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_REDIRECT_NET</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; for network&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_REDIRECT_HOST</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; for host&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_REDIRECT_TOSNET</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; for tos and net&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_REDIRECT_TOSHOST</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; for tos and host&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_ALTHOSTADDR</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP alternate host address&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_ECHO</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP echo&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_RTRADVERT</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP Route advertisement&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_RTRADVERT_NORMAL</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: normal&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_RTRADVERT_NOROUTE_COMMON</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: selective routing&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_RTRSOLICIT</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP Router solicitation&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_TIMEXCEED</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP time exceeded, code:&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_TIMEXCEED_INTRANS</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; ttl==0 in transit&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_TIMEXCEED_REASS</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ttl==0 in reass&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_PARAMPROB</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP ip header bad&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_PARAMPROB_ERRATPTR</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;:req. opt. absent&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_PARAMPROB_OPTABSENT</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: req. opt. absent&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_PARAMPROB_LENGTH</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: length&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_TSTAMP</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP timestamp request&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_TSTAMPREPLY</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP timestamp reply&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_INFO</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP information request&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_INFOREPLY</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP information reply&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_MASK</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP address mask request&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_MASKREPLY</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP address mask reply&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_TRACEROUTE</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP traceroute&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_DATACONVERR</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP data conversion error&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_MOBILE_REDIRECT</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP mobile host redirect&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_IP6_WHEREAREYOU</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP IPv6 where-are-you&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_IP6_IAMHERE</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP IPv6 i-am-here&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_MOBILE_REG</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP mobile registration req&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_MOBILE_REGREPLY</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP mobile registration reply&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_DNS</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP domain name request&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_DNSREPLY</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP domain name reply&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_PHOTURIS</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP Photuris&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_PHOTURIS_UNKNOWN_INDEX</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: unknown sec index&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_PHOTURIS_AUTH_FAILED</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: auth failed&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_PHOTURIS_DECOMPRESS_FAILED</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: decompress failed&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_PHOTURIS_DECRYPT_FAILED</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: decrypt failed&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_PHOTURIS_NEED_AUTHN</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: no authentication&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">icmp_code</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_PHOTURIS_NEED_AUTHZ</span><span class="p">:</span>
      <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;: no authorization&#39;</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">icmp_type</span> <span class="ow">is</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP_TYPE_MAX</span><span class="p">:</span>
    <span class="n">icmp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;ICMP Type Max&#39;</span><span class="p">)</span>

  <span class="k">return</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">icmp_data</span><span class="p">)</span></div>


<div class="viewcode-block" id="Stream"><a class="viewcode-back" href="../../../plaso.parsers.html#plaso.parsers.pcap.Stream">[docs]</a><span class="k">class</span> <span class="nc">Stream</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Used to store packet details on network streams parsed from a pcap file.&quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">packet</span><span class="p">,</span> <span class="n">prot_data</span><span class="p">,</span> <span class="n">source_ip</span><span class="p">,</span> <span class="n">dest_ip</span><span class="p">,</span> <span class="n">prot</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize new stream.</span>

<span class="sd">    Args:</span>
<span class="sd">      packet: Packet data.</span>
<span class="sd">      prot_data: Protocol level data for ARP, UDP, RCP, ICMP.</span>
<span class="sd">          other types of ether packets, this is just the ether.data.</span>
<span class="sd">      source_ip: Source IP.</span>
<span class="sd">      dest_ip: Dest IP.</span>
<span class="sd">      prot: Protocol (TCP, UDP, ICMP, ARP).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">prot_data</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dest_ip</span> <span class="o">=</span> <span class="n">dest_ip</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">packet_id</span> <span class="o">=</span> <span class="p">[</span><span class="n">packet</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">prot</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">packet</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">source_ip</span> <span class="o">=</span> <span class="n">source_ip</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">packet</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">packet</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="k">if</span> <span class="n">prot</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">u&#39;TCP&#39;</span><span class="p">,</span> <span class="s1">u&#39;UDP&#39;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dest_port</span> <span class="o">=</span> <span class="n">prot_data</span><span class="o">.</span><span class="n">dport</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">source_port</span> <span class="o">=</span> <span class="n">prot_data</span><span class="o">.</span><span class="n">sport</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dest_port</span> <span class="o">=</span> <span class="s1">u&#39;&#39;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">source_port</span> <span class="o">=</span> <span class="s1">u&#39;&#39;</span>

<div class="viewcode-block" id="Stream.AddPacket"><a class="viewcode-back" href="../../../plaso.parsers.html#plaso.parsers.pcap.Stream.AddPacket">[docs]</a>  <span class="k">def</span> <span class="nf">AddPacket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">packet</span><span class="p">,</span> <span class="n">prot_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add another packet to an existing stream.</span>

<span class="sd">    Args:</span>
<span class="sd">      packet: Packet data.</span>
<span class="sd">      prot_data: Protocol level data for ARP, UDP, RCP, ICMP.</span>
<span class="sd">          other types of ether packets, this is just the ether.data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">packet_id</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">packet</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">packet</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prot_data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">packet</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span></div>

<div class="viewcode-block" id="Stream.SpecialTypes"><a class="viewcode-back" href="../../../plaso.parsers.html#plaso.parsers.pcap.Stream.SpecialTypes">[docs]</a>  <span class="k">def</span> <span class="nf">SpecialTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks for some special types of packets.</span>

<span class="sd">    This method checks for some special packets and assembles usable data</span>
<span class="sd">    currently works for: DNS (udp 53), http, netbios (udp 137), ICMP.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A tuple consisting of a basic desctiption of the stream</span>
<span class="sd">      (i.e. HTTP Request) and the prettyfied string for the protocols.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">packet_details</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="s1">&#39;HTTP&#39;</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">http</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;HTTP Response: status: &#39;</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; reason: &#39;</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">reason</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; version: &#39;</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">u&#39;HTTP Response&#39;</span><span class="p">,</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">packet_details</span><span class="p">)</span>

      <span class="k">except</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">UnpackError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">packet_details</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">u&#39;HTTP Response Unpack Error: {0:s}. &#39;</span>
            <span class="s1">u&#39;First 20 of data {1:s}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">exception</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[:</span><span class="mi">20</span><span class="p">]))</span>
        <span class="k">return</span> <span class="s1">u&#39;HTTP Response&#39;</span><span class="p">,</span> <span class="n">packet_details</span>

      <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">packet_details</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">u&#39;HTTP Response Index Error: {0:s}. First 20 of data {1:s}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">exception</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[:</span><span class="mi">20</span><span class="p">]))</span>
        <span class="k">return</span> <span class="s1">u&#39;HTTP Response&#39;</span><span class="p">,</span> <span class="n">packet_details</span>

      <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">packet_details</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">u&#39;HTTP Response parsing error: {0:s}. &#39;</span>
            <span class="s1">u&#39;First 20 of data {1:s}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">exception</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[:</span><span class="mi">20</span><span class="p">]))</span>
        <span class="k">return</span> <span class="s1">u&#39;HTTP Response&#39;</span><span class="p">,</span> <span class="n">packet_details</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="s1">&#39;GET&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="s1">&#39;POST&#39;</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">http</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;HTTP Request: method: &#39;</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; uri: &#39;</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; version: &#39;</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; headers: &#39;</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">headers</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">u&#39;HTTP Request&#39;</span><span class="p">,</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">packet_details</span><span class="p">)</span>

      <span class="k">except</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">UnpackError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">packet_details</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">u&#39;HTTP Request unpack error: {0:s}. First 20 of data {1:s}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">exception</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[:</span><span class="mi">20</span><span class="p">]))</span>
        <span class="k">return</span> <span class="s1">u&#39;HTTP Request&#39;</span><span class="p">,</span> <span class="n">packet_details</span>

      <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">packet_details</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">u&#39;HTTP Request parsing error: {0:s}. &#39;</span>
            <span class="s1">u&#39;First 20 of data {1:s}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">exception</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[:</span><span class="mi">20</span><span class="p">]))</span>
        <span class="k">return</span> <span class="s1">u&#39;HTTP Request&#39;</span><span class="p">,</span> <span class="n">packet_details</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="s1">u&#39;UDP&#39;</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_port</span> <span class="o">==</span> <span class="mi">53</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest_port</span> <span class="o">==</span> <span class="mi">53</span><span class="p">):</span>
      <span class="c1"># DNS request/replies.</span>
      <span class="c1"># Check to see if the lengths are valid.</span>
      <span class="k">for</span> <span class="n">packet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">packet</span><span class="o">.</span><span class="n">ulen</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">packet</span><span class="p">):</span>
          <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;Truncated DNS packets - unable to parse: &#39;</span><span class="p">)</span>
          <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">40</span><span class="p">]))</span>
          <span class="k">return</span> <span class="s1">u&#39;DNS&#39;</span><span class="p">,</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">packet_details</span><span class="p">)</span>

      <span class="k">return</span> <span class="s1">u&#39;DNS&#39;</span><span class="p">,</span> <span class="n">ParseDNS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">)</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="s1">u&#39;UDP&#39;</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_port</span> <span class="o">==</span> <span class="mi">137</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest_port</span> <span class="o">==</span> <span class="mi">137</span><span class="p">):</span>
      <span class="k">return</span> <span class="s1">u&#39;NetBIOS&#39;</span><span class="p">,</span> <span class="n">ParseNetBios</span><span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">netbios</span><span class="o">.</span><span class="n">NS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">))</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="s1">u&#39;ICMP&#39;</span><span class="p">:</span>
      <span class="c1"># ICMP packets all end up as 1 stream, so they need to be</span>
      <span class="c1">#  processed 1 by 1.</span>
      <span class="k">return</span> <span class="s1">u&#39;ICMP&#39;</span><span class="p">,</span> <span class="n">ICMPTypes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\x03\x01</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]:</span>
      <span class="c1"># Some form of ssl3 data.</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">ssl</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">SSL2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;SSL data. Length: &#39;</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">len</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">u&#39;SSL&#39;</span><span class="p">,</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">packet_details</span><span class="p">)</span>
      <span class="k">except</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">UnpackError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">packet_details</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">u&#39;SSL unpack error: {0:s}. First 20 of data {1:s}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">exception</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[:</span><span class="mi">20</span><span class="p">]))</span>
        <span class="k">return</span> <span class="s1">u&#39;SSL&#39;</span><span class="p">,</span> <span class="n">packet_details</span>

    <span class="k">elif</span> <span class="n">b</span><span class="s1">&#39;</span><span class="se">\x03\x00</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]:</span>
       <span class="c1"># Some form of ssl3 data.</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">ssl</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ssl</span><span class="o">.</span><span class="n">SSL2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;SSL data. Length: &#39;</span><span class="p">)</span>
        <span class="n">packet_details</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">len</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">u&#39;SSL&#39;</span><span class="p">,</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">packet_details</span><span class="p">)</span>

      <span class="k">except</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">UnpackError</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">packet_details</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">u&#39;SSL unpack error: {0:s}. First 20 of data {1:s}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">exception</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[:</span><span class="mi">20</span><span class="p">]))</span>
        <span class="k">return</span> <span class="s1">u&#39;SSL&#39;</span><span class="p">,</span> <span class="n">packet_details</span>

    <span class="k">return</span> <span class="s1">u&#39;other&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol_data</span></div>

<div class="viewcode-block" id="Stream.Clean"><a class="viewcode-back" href="../../../plaso.parsers.html#plaso.parsers.pcap.Stream.Clean">[docs]</a>  <span class="k">def</span> <span class="nf">Clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clean up stream data.&quot;&quot;&quot;</span>
    <span class="n">clean_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">packet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_data</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">clean_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">packet</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span> <span class="o">=</span> <span class="n">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">clean_data</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PcapEvent"><a class="viewcode-back" href="../../../plaso.parsers.html#plaso.parsers.pcap.PcapEvent">[docs]</a><span class="k">class</span> <span class="nc">PcapEvent</span><span class="p">(</span><span class="n">time_events</span><span class="o">.</span><span class="n">PosixTimeEvent</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Convenience class for a PCAP record event.&quot;&quot;&quot;</span>

  <span class="n">DATA_TYPE</span> <span class="o">=</span> <span class="s1">u&#39;metadata:pcap&#39;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">stream_object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes the event.</span>

<span class="sd">    Args:</span>
<span class="sd">      timestamp: The POSIX value of the timestamp.</span>
<span class="sd">      usage: A usage description value.</span>
<span class="sd">      stream_object: The stream object (instance of Stream).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">PcapEvent</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">usage</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">source_ip</span> <span class="o">=</span> <span class="n">stream_object</span><span class="o">.</span><span class="n">source_ip</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dest_ip</span> <span class="o">=</span> <span class="n">stream_object</span><span class="o">.</span><span class="n">dest_ip</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">source_port</span> <span class="o">=</span> <span class="n">stream_object</span><span class="o">.</span><span class="n">source_port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dest_port</span> <span class="o">=</span> <span class="n">stream_object</span><span class="o">.</span><span class="n">dest_port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">stream_object</span><span class="o">.</span><span class="n">size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="n">stream_object</span><span class="o">.</span><span class="n">SpecialTypes</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_packet_id</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">stream_object</span><span class="o">.</span><span class="n">packet_id</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_packet_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">stream_object</span><span class="o">.</span><span class="n">packet_id</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">packet_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream_object</span><span class="o">.</span><span class="n">packet_id</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream_data</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">stream_object</span><span class="o">.</span><span class="n">stream_data</span><span class="p">[:</span><span class="mi">50</span><span class="p">])</span></div>


<div class="viewcode-block" id="PcapParser"><a class="viewcode-back" href="../../../plaso.parsers.html#plaso.parsers.pcap.PcapParser">[docs]</a><span class="k">class</span> <span class="nc">PcapParser</span><span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">FileObjectParser</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Parses PCAP files.&quot;&quot;&quot;</span>

  <span class="n">NAME</span> <span class="o">=</span> <span class="s1">u&#39;pcap&#39;</span>
  <span class="n">DESCRIPTION</span> <span class="o">=</span> <span class="s1">u&#39;Parser for PCAP files.&#39;</span>

  <span class="k">def</span> <span class="nf">_ParseIPPacket</span><span class="p">(</span>
      <span class="bp">self</span><span class="p">,</span> <span class="n">connections</span><span class="p">,</span> <span class="n">trunc_list</span><span class="p">,</span> <span class="n">packet_number</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span>
      <span class="n">packet_data_size</span><span class="p">,</span> <span class="n">ip_packet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parses an IP packet.</span>

<span class="sd">    Args:</span>
<span class="sd">      connections: A dictionary object to track the IP connections.</span>
<span class="sd">      trunc_list: A list of packets that truncated strangely and could</span>
<span class="sd">                  not be turned into a stream.</span>
<span class="sd">      packet_number: The PCAP packet number, where 1 is the first packet.</span>
<span class="sd">      timestamp: The PCAP packet timestamp.</span>
<span class="sd">      packet_data_size: The packet data size.</span>
<span class="sd">      ip_packet: The IP packet (instance of dpkt.ip.IP).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">packet_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">packet_number</span><span class="p">,</span> <span class="n">ip_packet</span><span class="p">,</span> <span class="n">packet_data_size</span><span class="p">]</span>

    <span class="n">source_ip_address</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">ip_packet</span><span class="o">.</span><span class="n">src</span><span class="p">)</span>
    <span class="n">destination_ip_address</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">ip_packet</span><span class="o">.</span><span class="n">dst</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ip_packet</span><span class="o">.</span><span class="n">p</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">IP_PROTO_TCP</span><span class="p">:</span>
      <span class="c1"># Later versions of dpkt seem to return a string instead of a TCP object.</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ip_packet</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="n">tcp</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">tcp</span><span class="o">.</span><span class="n">TCP</span><span class="p">(</span><span class="n">ip_packet</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">NeedData</span><span class="p">,</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">UnpackError</span><span class="p">):</span>
          <span class="n">trunc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">packet_values</span><span class="p">)</span>
          <span class="k">return</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="n">tcp</span> <span class="o">=</span> <span class="n">ip_packet</span><span class="o">.</span><span class="n">data</span>

      <span class="n">stream_key</span> <span class="o">=</span> <span class="s1">u&#39;tcp: {0:s}:{1:d} &gt; {2:s}:{3:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">source_ip_address</span><span class="p">,</span> <span class="n">tcp</span><span class="o">.</span><span class="n">sport</span><span class="p">,</span> <span class="n">destination_ip_address</span><span class="p">,</span> <span class="n">tcp</span><span class="o">.</span><span class="n">dport</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">stream_key</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">:</span>
        <span class="n">connections</span><span class="p">[</span><span class="n">stream_key</span><span class="p">]</span><span class="o">.</span><span class="n">AddPacket</span><span class="p">(</span><span class="n">packet_values</span><span class="p">,</span> <span class="n">tcp</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">connections</span><span class="p">[</span><span class="n">stream_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
            <span class="n">packet_values</span><span class="p">,</span> <span class="n">tcp</span><span class="p">,</span> <span class="n">source_ip_address</span><span class="p">,</span> <span class="n">destination_ip_address</span><span class="p">,</span>
            <span class="s1">u&#39;TCP&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ip_packet</span><span class="o">.</span><span class="n">p</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">IP_PROTO_UDP</span><span class="p">:</span>
      <span class="c1"># Later versions of dpkt seem to return a string instead of an UDP object.</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ip_packet</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="n">udp</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">udp</span><span class="o">.</span><span class="n">UDP</span><span class="p">(</span><span class="n">ip_packet</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">NeedData</span><span class="p">,</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">UnpackError</span><span class="p">):</span>
          <span class="n">trunc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">packet_values</span><span class="p">)</span>
          <span class="k">return</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="n">udp</span> <span class="o">=</span> <span class="n">ip_packet</span><span class="o">.</span><span class="n">data</span>

      <span class="n">stream_key</span> <span class="o">=</span> <span class="s1">u&#39;udp: {0:s}:{1:d} &gt; {2:s}:{3:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">source_ip_address</span><span class="p">,</span> <span class="n">udp</span><span class="o">.</span><span class="n">sport</span><span class="p">,</span> <span class="n">destination_ip_address</span><span class="p">,</span> <span class="n">udp</span><span class="o">.</span><span class="n">dport</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">stream_key</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">:</span>
        <span class="n">connections</span><span class="p">[</span><span class="n">stream_key</span><span class="p">]</span><span class="o">.</span><span class="n">AddPacket</span><span class="p">(</span><span class="n">packet_values</span><span class="p">,</span> <span class="n">udp</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">connections</span><span class="p">[</span><span class="n">stream_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
            <span class="n">packet_values</span><span class="p">,</span> <span class="n">udp</span><span class="p">,</span> <span class="n">source_ip_address</span><span class="p">,</span> <span class="n">destination_ip_address</span><span class="p">,</span>
            <span class="s1">u&#39;UDP&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ip_packet</span><span class="o">.</span><span class="n">p</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">IP_PROTO_ICMP</span><span class="p">:</span>
      <span class="c1"># Later versions of dpkt seem to return a string instead of</span>
      <span class="c1"># an ICMP object.</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ip_packet</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">icmp</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">icmp</span><span class="o">.</span><span class="n">ICMP</span><span class="p">(</span><span class="n">ip_packet</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">icmp</span> <span class="o">=</span> <span class="n">ip_packet</span><span class="o">.</span><span class="n">data</span>

      <span class="n">stream_key</span> <span class="o">=</span> <span class="s1">u&#39;icmp: {0:d} {1:s} &gt; {2:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">timestamp</span><span class="p">,</span> <span class="n">source_ip_address</span><span class="p">,</span> <span class="n">destination_ip_address</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">stream_key</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">:</span>
        <span class="n">connections</span><span class="p">[</span><span class="n">stream_key</span><span class="p">]</span><span class="o">.</span><span class="n">AddPacket</span><span class="p">(</span><span class="n">packet_values</span><span class="p">,</span> <span class="n">icmp</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">connections</span><span class="p">[</span><span class="n">stream_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
            <span class="n">packet_values</span><span class="p">,</span> <span class="n">icmp</span><span class="p">,</span> <span class="n">source_ip_address</span><span class="p">,</span> <span class="n">destination_ip_address</span><span class="p">,</span>
            <span class="s1">u&#39;ICMP&#39;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_ParseOtherPacket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">packet_values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parses a non-IP packet.</span>

<span class="sd">    Args:</span>
<span class="sd">      packet_values: list of packet values</span>

<span class="sd">    Returns:</span>
<span class="sd">      A stream object (instance of Stream) or None if the packet data</span>
<span class="sd">      is not supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ether</span> <span class="o">=</span> <span class="n">packet_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">stream_object</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_ARP</span><span class="p">:</span>
      <span class="n">arp</span> <span class="o">=</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span>
      <span class="n">arp_data</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">arp</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;ARP&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">arp</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">arp</span><span class="o">.</span><span class="n">ARP_OP_REQUEST</span><span class="p">:</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;arp request: target IP = &#39;</span><span class="p">)</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">arp</span><span class="o">.</span><span class="n">tpa</span><span class="p">))</span>
        <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arp_data</span><span class="p">)</span>

      <span class="k">elif</span> <span class="n">arp</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">arp</span><span class="o">.</span><span class="n">ARP_OP_REPLY</span><span class="p">:</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;arp reply: target IP = &#39;</span><span class="p">)</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">arp</span><span class="o">.</span><span class="n">tpa</span><span class="p">))</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; target MAC = &#39;</span><span class="p">)</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">arp</span><span class="o">.</span><span class="n">tha</span><span class="p">))</span>
        <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arp_data</span><span class="p">)</span>

      <span class="k">elif</span> <span class="n">arp</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">arp</span><span class="o">.</span><span class="n">ARP_OP_REVREQUEST</span><span class="p">:</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;arp protocol address request: target IP = &#39;</span><span class="p">)</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">arp</span><span class="o">.</span><span class="n">tpa</span><span class="p">))</span>
        <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arp_data</span><span class="p">)</span>

      <span class="k">elif</span> <span class="n">arp</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">arp</span><span class="o">.</span><span class="n">ARP_OP_REVREPLY</span><span class="p">:</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39;arp protocol address reply: target IP = &#39;</span><span class="p">)</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">arp</span><span class="o">.</span><span class="n">tpa</span><span class="p">))</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">u&#39; target MAC = &#39;</span><span class="p">)</span>
        <span class="n">arp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">arp</span><span class="o">.</span><span class="n">tha</span><span class="p">))</span>
        <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arp_data</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_IP6</span><span class="p">:</span>
      <span class="n">ip6</span> <span class="o">=</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ip6</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ip6</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;IPv6&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;IPv6&#39;</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_CDP</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;CDP&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;CDP&#39;</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_DTP</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;DTP&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;DTP&#39;</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_REVARP</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;RARP&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;Reverse ARP&#39;</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_8021Q</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;8021Q packet&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;8021Q packet&#39;</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_IPX</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;IPX&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;IPX&#39;</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_PPP</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;PPP&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;PPP&#39;</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_MPLS</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;MPLS&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;MPLS&#39;</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_MPLS_MCAST</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;MPLS&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;MPLS MCAST&#39;</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_PPPoE_DISC</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;PPOE&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;PPoE Disc packet&#39;</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_PPPoE</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;PPPoE&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;PPPoE&#39;</span>

    <span class="k">elif</span> <span class="n">ether</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mh">0x2452</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ether</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">src</span><span class="p">),</span>
          <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">ether</span><span class="o">.</span><span class="n">dst</span><span class="p">),</span> <span class="s1">u&#39;802.11&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;802.11&#39;</span>

    <span class="k">return</span> <span class="n">stream_object</span>

  <span class="k">def</span> <span class="nf">_ParseOtherStreams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_list</span><span class="p">,</span> <span class="n">trunc_list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Process PCAP packets that are not IP packets.</span>

<span class="sd">    For all packets that were not IP packets, create stream containers</span>
<span class="sd">    depending on the type of packet.</span>

<span class="sd">    Args:</span>
<span class="sd">      other_list: List of non-ip packets.</span>
<span class="sd">      trunc_list: A list of packets that truncated strangely and could</span>
<span class="sd">                  not be turned into a stream.</span>

<span class="sd">    Returns:</span>
<span class="sd">      A list of stream objects (instances of Stream).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">other_streams</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">packet_values</span> <span class="ow">in</span> <span class="n">other_list</span><span class="p">:</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ParseOtherPacket</span><span class="p">(</span><span class="n">packet_values</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">stream_object</span><span class="p">:</span>
        <span class="n">other_streams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream_object</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">packet_values</span> <span class="ow">in</span> <span class="n">trunc_list</span><span class="p">:</span>
      <span class="n">ip_packet</span> <span class="o">=</span> <span class="n">packet_values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

      <span class="n">source_ip_address</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">ip_packet</span><span class="o">.</span><span class="n">src</span><span class="p">)</span>
      <span class="n">destination_ip_address</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">ip_packet</span><span class="o">.</span><span class="n">dst</span><span class="p">)</span>
      <span class="n">stream_object</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span>
          <span class="n">packet_values</span><span class="p">,</span> <span class="n">ip_packet</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">source_ip_address</span><span class="p">,</span>
          <span class="n">destination_ip_address</span><span class="p">,</span> <span class="s1">u&#39;BAD&#39;</span><span class="p">)</span>
      <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol_data</span> <span class="o">=</span> <span class="s1">u&#39;Bad truncated IP packet&#39;</span>
      <span class="n">other_streams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream_object</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">other_streams</span>

<div class="viewcode-block" id="PcapParser.ParseFileObject"><a class="viewcode-back" href="../../../plaso.parsers.html#plaso.parsers.pcap.PcapParser.ParseFileObject">[docs]</a>  <span class="k">def</span> <span class="nf">ParseFileObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser_mediator</span><span class="p">,</span> <span class="n">file_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parses a PCAP file-like object.</span>

<span class="sd">    Args:</span>
<span class="sd">      parser_mediator: A parser mediator object (instance of ParserMediator).</span>
<span class="sd">      file_object: A file-like object.</span>

<span class="sd">    Raises:</span>
<span class="sd">      UnableToParseFile: when the file cannot be parsed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">file_object</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">pcap</span><span class="o">.</span><span class="n">FileHdr</span><span class="o">.</span><span class="n">__hdr_len__</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="n">file_header</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">pcap</span><span class="o">.</span><span class="n">FileHdr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
      <span class="n">packet_header_class</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">pcap</span><span class="o">.</span><span class="n">PktHdr</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">NeedData</span><span class="p">,</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">UnpackError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">UnableToParseFile</span><span class="p">(</span>
          <span class="s1">u&#39;[{0:s}] unable to parse file: {1:s} with error: {2:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="n">parser_mediator</span><span class="o">.</span><span class="n">GetDisplayName</span><span class="p">(),</span> <span class="n">exception</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">file_header</span><span class="o">.</span><span class="n">magic</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">pcap</span><span class="o">.</span><span class="n">PMUDPCT_MAGIC</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">file_header</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">pcap</span><span class="o">.</span><span class="n">LEFileHdr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">packet_header_class</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">pcap</span><span class="o">.</span><span class="n">LEPktHdr</span>

      <span class="k">except</span> <span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">NeedData</span><span class="p">,</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">UnpackError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exception</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">UnableToParseFile</span><span class="p">(</span>
            <span class="s1">u&#39;[{0:s}] unable to parse file: {1:s} with error: {2:s}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="n">parser_mediator</span><span class="o">.</span><span class="n">GetDisplayName</span><span class="p">(),</span> <span class="n">exception</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">file_header</span><span class="o">.</span><span class="n">magic</span> <span class="o">!=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">pcap</span><span class="o">.</span><span class="n">TCPDUMP_MAGIC</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">UnableToParseFile</span><span class="p">(</span><span class="s1">u&#39;Unsupported file signature&#39;</span><span class="p">)</span>

    <span class="n">packet_number</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">connections</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">other_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">trunc_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">file_object</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">pcap</span><span class="o">.</span><span class="n">PktHdr</span><span class="o">.</span><span class="n">__hdr_len__</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">data</span><span class="p">:</span>
      <span class="n">packet_header</span> <span class="o">=</span> <span class="n">packet_header_class</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
      <span class="n">timestamp</span> <span class="o">=</span> <span class="p">(</span><span class="n">packet_header</span><span class="o">.</span><span class="n">tv_sec</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">)</span> <span class="o">+</span> <span class="n">packet_header</span><span class="o">.</span><span class="n">tv_usec</span>
      <span class="n">packet_data</span> <span class="o">=</span> <span class="n">file_object</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">packet_header</span><span class="o">.</span><span class="n">caplen</span><span class="p">)</span>

      <span class="n">ethernet_frame</span> <span class="o">=</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">Ethernet</span><span class="p">(</span><span class="n">packet_data</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">ethernet_frame</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">dpkt</span><span class="o">.</span><span class="n">ethernet</span><span class="o">.</span><span class="n">ETH_TYPE_IP</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ParseIPPacket</span><span class="p">(</span>
            <span class="n">connections</span><span class="p">,</span> <span class="n">trunc_list</span><span class="p">,</span> <span class="n">packet_number</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">ethernet_frame</span><span class="p">),</span> <span class="n">ethernet_frame</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="n">packet_values</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">timestamp</span><span class="p">,</span> <span class="n">packet_number</span><span class="p">,</span> <span class="n">ethernet_frame</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ethernet_frame</span><span class="p">)]</span>
        <span class="n">other_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">packet_values</span><span class="p">)</span>

      <span class="n">packet_number</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">file_object</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">dpkt</span><span class="o">.</span><span class="n">pcap</span><span class="o">.</span><span class="n">PktHdr</span><span class="o">.</span><span class="n">__hdr_len__</span><span class="p">)</span>

    <span class="n">other_streams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ParseOtherStreams</span><span class="p">(</span><span class="n">other_list</span><span class="p">,</span> <span class="n">trunc_list</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">stream_object</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">connections</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">u&#39;start_time&#39;</span><span class="p">)):</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">stream_object</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="s1">u&#39;ICMP&#39;</span><span class="p">:</span>
        <span class="n">stream_object</span><span class="o">.</span><span class="n">Clean</span><span class="p">()</span>

      <span class="n">event_objects</span> <span class="o">=</span> <span class="p">[</span>
          <span class="n">PcapEvent</span><span class="p">(</span>
              <span class="nb">min</span><span class="p">(</span><span class="n">stream_object</span><span class="o">.</span><span class="n">timestamps</span><span class="p">),</span>
              <span class="n">eventdata</span><span class="o">.</span><span class="n">EventTimestamp</span><span class="o">.</span><span class="n">START_TIME</span><span class="p">,</span> <span class="n">stream_object</span><span class="p">),</span>
          <span class="n">PcapEvent</span><span class="p">(</span>
              <span class="nb">max</span><span class="p">(</span><span class="n">stream_object</span><span class="o">.</span><span class="n">timestamps</span><span class="p">),</span>
              <span class="n">eventdata</span><span class="o">.</span><span class="n">EventTimestamp</span><span class="o">.</span><span class="n">END_TIME</span><span class="p">,</span> <span class="n">stream_object</span><span class="p">)]</span>

      <span class="n">parser_mediator</span><span class="o">.</span><span class="n">ProduceEvents</span><span class="p">(</span><span class="n">event_objects</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">stream_object</span> <span class="ow">in</span> <span class="n">other_streams</span><span class="p">:</span>
      <span class="n">event_objects</span> <span class="o">=</span> <span class="p">[</span>
          <span class="n">PcapEvent</span><span class="p">(</span>
              <span class="nb">min</span><span class="p">(</span><span class="n">stream_object</span><span class="o">.</span><span class="n">timestamps</span><span class="p">),</span>
              <span class="n">eventdata</span><span class="o">.</span><span class="n">EventTimestamp</span><span class="o">.</span><span class="n">START_TIME</span><span class="p">,</span> <span class="n">stream_object</span><span class="p">),</span>
          <span class="n">PcapEvent</span><span class="p">(</span>
              <span class="nb">max</span><span class="p">(</span><span class="n">stream_object</span><span class="o">.</span><span class="n">timestamps</span><span class="p">),</span>
              <span class="n">eventdata</span><span class="o">.</span><span class="n">EventTimestamp</span><span class="o">.</span><span class="n">END_TIME</span><span class="p">,</span> <span class="n">stream_object</span><span class="p">)]</span>
      <span class="n">parser_mediator</span><span class="o">.</span><span class="n">ProduceEvents</span><span class="p">(</span><span class="n">event_objects</span><span class="p">)</span></div></div>


<span class="n">manager</span><span class="o">.</span><span class="n">ParsersManager</span><span class="o">.</span><span class="n">RegisterParser</span><span class="p">(</span><span class="n">PcapParser</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Plaso 1.4.1_20160603 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../plaso.html" >plaso</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright The Plaso Project Authors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.2.
    </div>
  </body>
</html>